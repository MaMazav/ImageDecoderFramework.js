var v=u();self.asyncProxyScriptBlob=new v;
function u(){function c(){this.j=["'use strict';"];this.ma=this.O=null;this.Bb={};this.a(u,"BlobScriptGenerator");this.g("var asyncProxyScriptBlob = new BlobScriptGenerator();")}c.prototype.a=function(b,a,d,c){if(this.O)throw Error("Cannot add member to AsyncProxyScriptBlob after blob was used");a&&(d?(this.Bb[d]=!0,this.j.push(d),this.j.push(".")):this.j.push("var "),this.j.push(a),this.j.push(" = "));this.j.push("(");this.j.push(b.toString());this.j.push(")(");this.j.push(c||"");this.j.push(");")};
c.prototype.g=function(b){if(this.O)throw Error("Cannot add statement to AsyncProxyScriptBlob after blob was used");this.j.push(b)};c.prototype.getBlob=function(){this.O||(this.O=new Blob(this.j,{type:"application/javascript"}));return this.O};c.prototype.Lb=function(){this.ma||(this.ma=URL.createObjectURL(this.getBlob()));return this.ma};return c};function w(){function c(d){if(null===a)throw"AsyncProxy internal error: SubWorkerEmulationForChrome not initialized";this.ea=++b;a[this.ea]=this;self.postMessage({type:"subWorkerCtor",H:this.ea,Vb:d})}var b=0,a=null;c.Ga=function(d){a=d};c.prototype.postMessage=function(a,b){self.postMessage({type:"subWorkerPostMessage",H:this.ea,data:a},b)};c.prototype.terminate=function(a,b){self.postMessage({type:"subWorkerTerminate",H:this.ea},b)};self.asyncProxyScriptBlob.a(w,"SubWorkerEmulationForChrome");return c}
var aa=w();function x(){function c(b,a,d){b.prototype[a]="function"===typeof d?d:function(){for(var b=this._getWorkerHelper(),c=[],f=0;f<arguments.length;++f){var l=d[f+1],h=arguments[f];if("callback"===l)c[f]=b.sb(h);else{if(l)throw"AsyncProxyFactory error: Unrecognized argument description "+l+" in argument "+(f+1)+" of method "+a;c[f]=h}}return b.Ba(a,c,d[0])}}self.asyncProxyScriptBlob.a(x,"AsyncProxyFactory");return{create:function(b,a,d,g){if(!(b&&0<b.length))throw"AsyncProxyFactory error: missing scriptsToImport (2nd argument)";
if(!d)throw"AsyncProxyFactory error: missing methods (3rd argument)";g=g||function(){for(var a=arguments,d=Array(a.length),b=0;b<a.length;++b)d[b]=a[b];this.vb=d};g.prototype._getWorkerHelper=function(){this.Qa||(this.Qa=new self.AsyncProxy.AsyncProxyMaster(b,a,this.vb||[]));return this.Qa};for(var e in d)c(g,e,d[e]||[]);return g}}}var y=x();function z(){function c(d,g,r,e){var k=this;e=e||{};var h=b.toString(),h=h.replace("SCRIPT_PLACEHOLDER",f.Lb()),h=URL.createObjectURL(new Blob(["(",h,")()"],{type:"application/javascript"}));k.b=[];k.R=[];k.xa=[];k.ya=[];k.ha=new Worker(h);k.ha.onmessage=function(d){a(k,d)};k.Aa=null;k.aa=0;k.Ta=e.functionsBufferSize||5;k.ua=[];k.ha.postMessage({Ca:"ctor",Wb:d,Kb:g,F:r,f:++l,kb:!1,Rb:c.hb()})}function b(){importScripts("SCRIPT_PLACEHOLDER");AsyncProxy.AsyncProxySlave=self.AsyncProxy.AsyncProxySlaveSingleton;
AsyncProxy.AsyncProxySlave.Ab()}function a(a,b){var c=b.data.f;switch(b.data.type){case "functionCalled":--a.aa;e(a);break;case "promiseResult":var g=a.R[c];delete a.R[c];g.resolve(b.data.result);break;case "promiseFailure":g=a.R[c];delete a.R[c];g.reject(b.data.reason);break;case "userData":null!==a.Aa&&a.Aa(b.data.dc);break;case "callback":c=a.b[b.data.f];if(void 0===c)throw"Unexpected message from SlaveWorker of callback ID: "+b.data.f+". Maybe should indicate isMultipleTimesCallback = true on creation?";
c.Ha||a.gb(a.b[b.data.f]);null!==c.fb&&c.fb.apply(null,b.data.F);break;case "subWorkerCtor":var c=new Worker(b.data.Vb),k=b.data.H;a.xa[k]=c;a.ya.push(c);c.onmessage=function(b){d(a,b.ports,!1,{Ca:"subWorkerOnMessage",H:k,data:b.data})};break;case "subWorkerPostMessage":c=a.xa[b.data.H];c.postMessage(b.data.data);break;case "subWorkerTerminate":c=a.xa[b.data.H];c.terminate();break;default:throw"Unknown message from AsyncProxySlave of type: "+b.data.type;}}function d(a,b,d,c){a.aa>=a.Ta?a.ua.push({cc:b,
Pb:d,message:c}):g(a,b,d,c)}function g(a,b,d,c){d&&++a.aa;a.ha.postMessage(c,b)}function e(a){for(;a.aa<a.Ta&&0<a.ua.length;){var b=a.ua.shift();g(a,b.cc,b.Pb,b.message)}}var f=self.asyncProxyScriptBlob,l=0,h=!1,k=function(){var a=location.href,b=a.lastIndexOf("/");0<=b&&(a=a.substring(0,b));return a}();c.prototype.$b=function(a){this.Aa=a};c.prototype.terminate=function(){this.ha.terminate();for(var a=0;a<this.ya.length;++a)this.ya[a].terminate()};c.prototype.Ba=function(a,b,e){e=e||{};var k=!!e.isReturnPromise,
f=e.transferables||[],h=e.pathsToTransferablesInPromiseResult,n=++l,q=null,ca=this;k&&(q=new Promise(function(a,b){ca.R[n]={resolve:a,reject:b}}));e=e.isSendImmediately?g:d;f="function"===typeof f?f():c.na(f,b);e(this,f,!0,{Ca:a,F:b||[],f:n,kb:k,Tb:h});if(k)return q};c.prototype.sb=function(a,b,d){d=d||{};var c=++l;b={Qb:!0,Ha:!!d.isMultipleTimeCallback,f:c,Jb:b,nb:d.pathsToTransferables};this.b[c]={Ha:!!d.isMultipleTimeCallback,f:c,fb:a,nb:d.pathsToTransferables};return b};c.prototype.gb=function(a){delete this.b[a.f]};
c.hb=function(){h=!0;return k};c.Fb=function(a){if(k!==a&&h)throw"Previous values returned from getMasterEntryUrl is wrong. Avoid calling it within the slave c`tor";k=a};c.na=function(a,b){if(void 0!==a){for(var d=Array(a.length),c=0;c<a.length;++c){for(var g=a[c],e=b,k=0;k<g.length;++k)e=e[g[k]];d[c]=e}return d}};f.a(z,"AsyncProxyMaster");return c}var A=z();function B(){function c(){var b;try{for(var d=l.split("."),c=self,g=0;g<d.length;++g)c=c[d[g]];var d=c,e=[null].concat(a(arguments));b=new (Function.prototype.bind.apply(d,e))}catch(f){throw Error("Failed locating class name "+l+": "+f);}return b}function b(a){var b=a.data.Ca,g=a.data.F,h=a.data.f,t=a.data.kb,ba=a.data.Tb;switch(b){case "ctor":self.AsyncProxy.AsyncProxyMaster.Fb(a.data.Rb);h=a.data.Wb;l=a.data.Kb;for(var m=0;m<h.length;++m)importScripts(h[m]);e=c.apply(null,g);return;case "subWorkerOnMessage":f[a.data.H].onmessage({data:a.data.data});
return}g=Array(a.data.F.length);for(m=0;m<a.data.F.length;++m){var n=a.data.F[m];void 0!==n&&null!==n&&n.Qb&&(n=d.tb(n));g[m]=n}for(var m=e,q;m&&!(q=e[b]);)m=m.__proto__;if(!q)throw"AsyncProxy error: could not find function "+b;g=q.apply(e,g);t&&d.ub(h,g,ba);self.postMessage({type:"functionCalled",f:a.data.f,result:null})}function a(a){for(var b=Array(a.length),d=0;d<a.length;++d)b[d]=a[d];return b}var d={},g=null,e,f={},l;d.Ab=function(){self.onmessage=b};d.Zb=function(a){c=a};d.Yb=function(a){g=
a};d.Xb=function(a){self.postMessage({type:"userData",dc:a})};d.ub=function(a,b,d){b.then(function(b){var c=self.AsyncProxy.AsyncProxyMaster.na(d,b);self.postMessage({type:"promiseResult",f:a,result:b},c)})["catch"](function(b){self.postMessage({type:"promiseFailure",f:a,reason:b})})};d.tb=function(b){var d=!1;return function(){if(d)throw"Callback is called twice but isMultipleTimeCallback = false";var c=a(arguments);if(null!==g)try{g.call(e,"callback",b.Jb,c)}catch(f){console.log("AsyncProxySlave.beforeOperationListener has thrown an exception: "+
f)}var h=self.AsyncProxy.AsyncProxyMaster.na(b.nb,c);self.postMessage({type:"callback",f:b.f,F:c},h);b.Ha||(d=!0)}};d.pa=function(){return C.pa(Error())};if(void 0===self.Worker){var h=self.SubWorkerEmulationForChrome;h.Ga(f);self.Worker=h}self.asyncProxyScriptBlob.a(B,"AsyncProxySlaveSingleton");return d}var D=B();function E(){function c(){this.wa={};this.S=null}c.prototype.Ib=function(b){b=c.pa(b);this.wa[b]||(this.wa[b]=!0,this.S=null)};c.prototype.Mb=function(){if(null===this.S){this.S=[];for(var b in this.wa)this.S.push(b)}return this.S};c.pa=function(b){var a=b.stack.trim(),d=/at (|[^ ]+ \()([^ ]+):\d+:\d+/.exec(a);if(d&&""!==d[2])return d[2];if((d=(new RegExp(/.+\/(.*?):\d+(:\d+)*$/)).exec(a))&&""!==d[1])return d[1];if(void 0!=b.fileName)return b.fileName;throw"ImageDecoderFramework.js: Could not get current script URL";
};self.asyncProxyScriptBlob.a(E,"ScriptsToImportPool");return c}var C=E();var F=function(){function c(){this.clear()}c.prototype.clear=function(){this.oa={C:null,ba:this};this.Z={B:null,ba:this};this.l=0;this.Z.C=this.oa;this.oa.B=this.Z};c.prototype.add=function(b,a){if(null===a||void 0===a)a=this.Z;this.ga(a);++this.l;var d={Hb:b,B:a,C:a.C,ba:this};d.C.B=d;return a.C=d};c.prototype.remove=function(b){this.ga(b);--this.l;b.C.B=b.B;b.B.C=b.C;b.ba=null};c.prototype.s=function(b){this.ga(b);return b.Hb};c.prototype.o=function(){return this.u(this.oa)};c.prototype.u=function(b){this.ga(b);
return b.B===this.Z?null:b.B};c.prototype.ga=function(b){if(b.ba!==this)throw"iterator must be of the current LinkedList";};return c}();var G=function(){function c(b){this.$=[];this.L=new F;this.Y=b;this.l=0}c.prototype.ib=function(b){var a=this.Y.getHashCode(b),a=this.$[a];if(!a)return null;for(var a=a.list,d=a.o();null!==d;){var c=a.s(d);if(this.Y.isEqual(c.key,b))return c.value;d=a.u(d)}return null};c.prototype.s=function(b){return b.h.list.s(b.i).value};c.prototype.Pa=function(b,a){var d=this.Y.getHashCode(b),c=this.$[d];c||(c={Ob:d,list:new F,Ka:null},c.Ka=this.L.add(c),this.$[d]=c);d={h:c,i:null};for(d.i=c.list.o();null!==d.i;){var e=
c.list.s(d.i);if(this.Y.isEqual(e.key,b))return{iterator:d,Ia:!1,value:e.value};d.i=c.list.u(d.i)}e=a();d.i=c.list.add({key:b,value:e});++this.l;return{iterator:d,Ia:!0,value:e}};c.prototype.remove=function(b){var a=b.h.list.l;b.h.list.remove(b.i);var d=b.h.list.l;this.l+=d-a;0===d&&(this.L.remove(b.h.Ka),delete this.$[b.h.Ob])};c.prototype.o=function(){var b=this.L.o(),a=null,d=null;null!==b&&(a=this.L.s(b),d=a.list.o());return null===d?null:{h:a,i:d}};c.prototype.u=function(b){for(var a={h:b.h,
i:b.h.list.u(b.i)};null===a.i;){var d=this.L.u(b.h.Ka);if(null===d)return null;a.h=this.L.s(d);a.i=a.h.list.o()}return a};return c}();function H(){function c(a){this.T=a;this.qa=new I;this.eb=[];this.zb=this.U.bind(this);if(!a.createTaskContext)throw"AsyncProxy.DependencyWorkers: No workerInputRetreiver.createTaskContext() method";if(!a.getTaskOptions)throw"AsyncProxy.DependencyWorkers: No workerInputRetreiver.getTaskOptions() method";}var b=self.asyncProxyScriptBlob;c.prototype.Na=function(a,b){var c=this.qa.Pa(a,function(){return new da}),e=c.value,f=new J(e,b);c.Ia&&(e.Ga(a,this,this.qa,c.iterator,this.T),this.Gb(e));return f};
c.prototype.bc=function(a){var b=this;return new Promise(function(c,e){var f=b.Na(a,{onData:function(a){l=!0;h=a},onTerminated:function(){l?c(h):e("AsyncProxy.DependencyWorkers: Internal error - task terminated but no data returned")}}),l=f.Fa(),h;l&&(h=f.Da())})};c.prototype.U=function(a){a=this.qa.ib(a);return null===a?null:a.W};c.prototype.Gb=function(a){taskContext=this.T.createTaskContext(a.ka,{getTaskContext:this.zb,onDataReadyToProcess:function(c,e){if(a.ja)throw"AsyncProxy.DependencyWorkers: already terminated";
a.N?(a.Ma=c,a.Ja=!0,a.ob=e):b.bb(a,c,e)},onTerminated:a.Sb,registerTaskDependency:a.Ub});a.W=taskContext;if(!taskContext.getTaskType)throw"AsyncProxy.DependencyWorkers: missing taskContext.getTaskType()";if(!taskContext.statusUpdated)throw"AsyncProxy.DependencyWorkers: missing taskContext.statusUpdated()";if(!taskContext.onDependencyTaskResult)throw"AsyncProxy.DependencyWorkers: missing taskContext.onDependencyTaskResult()";a.la=a.W.getTaskType();var b=this};c.prototype.bb=function(a,b,c){var e=this;
if(c)a.mb(b);else{var f,l=e.eb[a.la];l||(l=[],e.eb[a.la]=l);0<l.length?f=l.pop():(c=e.T.getTaskOptions(a.la),f=new A(c.scriptsToImport,c.ctorName,c.ctorArgs));a.N||(a.N=!0,a.V());f.Ba("start",[b,a.ka],{isReturnPromise:!0}).then(function(b){a.mb(b);return b})["catch"](function(a){console.log("Error in DependencyWorkers' worker: "+a);return a}).then(function(b){l.push(f);if(a.Ja){var c=a.Ma;a.Ja=!1;a.Ma=null;e.bb(a,c,a.ob);return b}a.N=!1;a.V()})}};b.a(H,"DependencyWorkers");return c}var K=H();var J=function ea(){function b(a,b){this.c=a;this.ra=0;this.b=b;this.fa=a.A.add(this)}b.prototype.Fa=function(){return this.c.jb};b.prototype.Da=function(){return this.c.lb};b.prototype.qb=function(a){if(!this.fa)throw"AsyncProxy.DependencyWorkers: Already unregistered";a=a>this.c.G?a:this.ra<this.c.G?this.c.G:this.c.pb();this.c.rb(a)};b.prototype.unregister=function(){if(!this.fa)throw"AsyncProxy.DependencyWorkers: Already unregistered";this.c.A.remove(this.fa);this.fa=null;if(0==this.c.A.l)this.c.ja||
(this.c.ended(),this.c.V());else if(this.ra===this.c.G){var a=this.c.pb();this.c.rb(a)}};asyncProxyScriptBlob.a(ea,"DependencyWorkersTaskHandle");return b}();var da=function(){function c(){this.ja=!1;this.G=0;this.lb=null;this.Ja=this.N=this.jb=!1;this.Ma=null;this.ob=!1;this.W=null;this.A=new F;this.Sb=this.sa.bind(this);this.Ub=this.Eb.bind(this);this.la=this.ka=null;this.Sa=0;this.v=this.ta=this.Za=this.Ya=null}c.prototype.Ga=function(b,a,c,g){this.ka=b;this.Ya=a;this.Za=c;this.ta=g;this.v=new I};c.prototype.ended=function(){for(var b=this.v.o();null!=b;){var a=this.v.s(b).X,b=this.v.u(b);a.unregister()}for(b=this.A.o();null!=b;)if(a=this.A.s(b),b=
this.A.u(b),a.b.onTerminated)a.b.onTerminated();this.A.clear();this.v=[];this.Za.remove(this.ta);this.ta=null};c.prototype.rb=function(b){if(this.G!==b){this.G=b;this.V();for(var a=this.v.o();null!=a;){var c=this.v.s(a).X,a=this.v.u(a);c.qb(b)}}};c.prototype.V=function(){this.W.statusUpdated({priority:this.G,hasListeners:0<this.A.l,isWaitingForWorkerResult:this.N,terminatedDependsTasks:this.Sa,dependsTasks:this.v.l})};c.prototype.pb=function(){for(var b=this.A,a=b.o(),c=0;null!=a;)c=b.s(a).ra,a=b.u(a);
return c};c.prototype.mb=function(b){this.jb=!0;this.lb=b;for(var a=this.A,c=a.o();null!=c;){var g=a.s(c),c=a.u(c);g.b.onData(b,this.ka)}};c.prototype.sa=function(){if(this.ja)throw"AsyncProxy.DependencyWorkers: already terminated";if(this.N)throw"AsyncProxy.DependencyWorkers: Cannot terminate while task is processing. Wait for statusUpdated() callback with isWaitingForWorkerResult == false";this.ja=!0;this.ended()};c.prototype.yb=function(){++this.Sa;this.V()};c.prototype.Eb=function(b){function a(a){g.W.onDependencyTaskResult(a,
b);e=!0}var c=this.v.Pa(b,function(){return{X:null}});if(!c.Ia)throw"AsyncProxy.DependencyWorkers: Cannot add task dependency twice";var g=this,e=!1,f=!1;c.value.X=this.Ya.Na(b,{onData:a,onTerminated:function(){if(f)throw"AsyncProxy.DependencyWorkers: Double termination";f=!0;g.yb()}});setTimeout(function(){!e&&c.value.X.Fa()&&a(c.X.Da())})};return c}();function L(){function c(a){if(!a.getTaskOptions)throw"AsyncProxy.DependencyWorkers: No inputRetreiver.getTaskOptions() method";this.Va=a}var b=self.asyncProxyScriptBlob;c.prototype.ia=function(){throw"AsyncProxy.WrapperInputRetreiverBase internal error: Not implemented createTaskContext()";};c.prototype.Nb=function(a){return this.Va.getTaskOptions(a)};b.a(L,"WrapperInputRetreiverBase");return c}var M=L();function N(){function c(a,b,c,e){this.cb=a;this.P=b;this.T=c;this.b=e;this.da=null;this.ab=[];this.Ua=[];this.D=1;this.Ra();for(a=0;a<b.length;++a)e.registerTaskDependency(b[a])}var b=self.asyncProxyScriptBlob;Object.defineProperty(c.prototype,"dependsOnTasks",{get:function(){return this.P}});c.prototype.La=function(a,b){if(1!==this.D)throw"AsyncProxy.PromiseTask: Internal Error: not waiting for tasks depends on";if(null===this.da){this.da=new I;for(var c=0;c<this.P.length;++c)this.da.Pa(this.P[c],
function(){return c})}var e=this.da.ib(b);if(null===e)throw"AsyncProxy.PromiseTask: Task is not depends on key";this.ab[e]=a;this.Ua[e]||(this.Ua[e]=!0)};c.prototype.Oa=function(a){a.hasListeners||a.isWaitingForWorkerResult?1===this.D?this.Ra(a):a.isWaitingForWorkerResult||3!==this.D||this.za():this.za("No listeners")};c.prototype.Ea=function(){return 0};c.prototype.Ra=function(a){var b=0;a&&(b=a.terminatedDependsTasks);if(b===this.P.length){var c=this;this.D=2;this.T.preWorkerProcess(this.ab,this.P,
this.cb).then(function(a){4!==c.D&&(c.D=3,c.b.onDataReadyToProcess(a))})["catch"](function(a){c.za(a)})}};c.prototype.za=function(a){4!==this.D&&(this.D=4,this.b.onTerminated(a))};b.a(N,"PromiseTask");return c}var O=N();function P(c){function b(a){c.call(this,a);this.$a=a;if(!a.getDependsOnTasks)throw"AsyncProxy.DependencyWorkers: No promiseInputRetreiver.getDependsOnTasks() method";if(!a.preWorkerProcess)throw"AsyncProxy.DependencyWorkers: No promiseInputRetreiver.preWorkerProcess() method";}var a=self.asyncProxyScriptBlob;b.prototype=Object.create(c.prototype);b.prototype.ia=function(a,b){var c=this.$a.getDependsOnTasks(a);return new O(a,c,this.$a,b)};a.a(P,"PromiseWrapperInputRetreiver",null,"WrapperInputRetreiverBase");
return b}var Q=P(M);function R(c){function b(a){a=new Q(a);c.call(this,a)}var a=self.asyncProxyScriptBlob;b.prototype=Object.create(c.prototype);a.a(R,"PromiseDependencyWorkers",null,"DependencyWorkers");return b}var S=R(K);function T(){function c(a,b,c){this.M=a;this.cb=b;this.va=this.w=null;this.b=c;this.Xa=this.Db.bind(this);this.wb={onDataReadyToProcess:this.Cb.bind(this),onTerminated:this.sa.bind(this),registerTaskDependency:c.registerTaskDependency};this.ca=null;this.J=this.I=this.m=!1;this.K={isWaitingForWorkerResult:!1}}var b=self.asyncProxyScriptBlob;c.prototype.ac=function(a){if(!a.statusUpdated)throw"AsyncProxy.DependencyWorkers: missing taskContext.statusUpdated()";if(!a.onDependencyTaskResult)throw"AsyncProxy.DependencyWorkers: missing taskContext.onDependencyTaskResult()";
if(!a.getTaskType)throw"AsyncProxy.DependencyWorkers: missing taskContext.getTaskType()";this.w=a};c.prototype.Oa=function(a){this.K=JSON.parse(JSON.stringify(a));this.xb(a);this.K.isWaitingForWorkerResult=a.isWaitingForWorkerResult||this.m;return this.w.statusUpdated(this.K)};c.prototype.La=function(a,b){return this.w.onDependencyTaskResult(a,b)};c.prototype.Ea=function(){return this.w.getTaskType()};c.prototype.Cb=function(a,b){if(this.Wa)throw"AsyncProxy.DependencyWorkers: Data after termination";
if(b)this.ca=null,this.I=this.m&&!this.J,this.m=!1,this.b.onDataReadyToProcess(a,b),this.K.isWaitingForWorkerResult&&!this.m&&(this.K.isWaitingForWorkerResult=!1,this.w.statusUpdated(this.K));else{this.ca=a;this.I=!1;var c=this.m;this.m=!0;c||this.J||this.M.enqueueJob(this.Xa,this.w)}};c.prototype.Db=function(a,b){if(b!==this.w)throw"AsyncProxy.DependencyWorkers: Unexpected context";this.I&&(this.I=!1,this.M.jobDone(a,b));if(!this.m)throw"AsyncProxy.DependencyWorkers: !enqueuedProcessJob";this.J=
!0;this.m=!1;this.va=a;this.b.onDataReadyToProcess(this.ca);this.ca=null};c.prototype.xb=function(a){if(this.J&&!a.isWaitingForWorkerResult){if(this.I)throw"AsyncProxy.DependencyWorkers: cancelPendingDataToProcess";this.J=!1;a=this.va;this.va=null;this.m&&this.M.enqueueJob(this.Xa,this.w);this.M.jobDone(a,this.w)}};c.prototype.sa=function(){if(this.Wa)throw"AsyncProxy.DependencyWorkers: Double termination";this.Wa=!0;this.I=this.m&&!this.J;this.m=!1;this.b.onTerminated()};b.a(T,"SchedulerTask");return c}
var U=T();function V(c){function b(a,b){c.call(this,b);this.M=a;if(!b.createTaskContext)throw"AsyncProxy.DependencyWorkers: No inputRetreiver.createTaskContext() method";}var a=self.asyncProxyScriptBlob;b.prototype=Object.create(c.prototype);b.prototype.ia=function(a,b){var c=new U(this.M,a,b),f=this.Va.createTaskContext(a,c.wb);c.ac(f);return c};a.a(V,"SchedulerWrapperInputRetreiver",null,"WrapperInputRetreiverBase");return b}var W=V(M);function X(c){function b(a,b){var e=new W(a,b);c.call(this,e);if(!b.createTaskContext)throw"AsyncProxy.DependencyWorkers: No inputRetreiver.createTaskContext() method";}var a=self.asyncProxyScriptBlob;b.prototype=Object.create(c.prototype);b.prototype.U=function(a){return c.prototype.U.call(this,a).w};a.a(X,"SchedulerDependencyWorkers",null,"DependencyWorkers");return b}var Y=X(K);function Z(){asyncProxyScriptBlob.a(Z,"ExportAsyncProxySymbols");asyncProxyScriptBlob.g("ExportAsyncProxySymbols(SubWorkerEmulationForChrome, AsyncProxyFactory, AsyncProxySlaveSingleton, AsyncProxyMaster, ScriptsToImportPool, DependencyWorkers, DependencyWorkersTaskHandle, WrapperInputRetreiverBase, PromiseTask, PromiseWrapperInputRetreiver, PromiseDependencyWorkers, SchedulerTask, SchedulerWrapperInputRetreiver, SchedulerDependencyWorkers);");asyncProxyScriptBlob.g("self['AsyncProxy']['AsyncProxyFactory'] = AsyncProxyFactory;");
asyncProxyScriptBlob.g("self['AsyncProxy']['AsyncProxySlaveSingleton'] = AsyncProxySlaveSingleton;");asyncProxyScriptBlob.g("self['AsyncProxy']['AsyncProxyMaster'] = AsyncProxyMaster;");asyncProxyScriptBlob.g("self['AsyncProxy']['ScriptsToImportPool'] = ScriptsToImportPool;");asyncProxyScriptBlob.g("self['AsyncProxy']['DependencyWorkers'] = DependencyWorkers;");asyncProxyScriptBlob.g("self['AsyncProxy']['WrapperInputRetreiverBase'] = WrapperInputRetreiverBase;");asyncProxyScriptBlob.g("self['AsyncProxy']['PromiseTask'] = PromiseTask;");
asyncProxyScriptBlob.g("self['AsyncProxy']['PromiseWrapperInputRetreiver'] = PromiseWrapperInputRetreiver;");asyncProxyScriptBlob.g("self['AsyncProxy']['PromiseDependencyWorkers'] = PromiseDependencyWorkers;");asyncProxyScriptBlob.g("self['AsyncProxy']['SchedulerTask'] = SchedulerTask;");asyncProxyScriptBlob.g("self['AsyncProxy']['SchedulerWrapperInputRetreiver'] = SchedulerWrapperInputRetreiver;");asyncProxyScriptBlob.g("self['AsyncProxy']['SchedulerDependencyWorkers'] = SchedulerDependencyWorkers;");
return function(c,b,a,d,g,e,f,l,h,k,fa,p,r,t){self.AsyncProxy=self.AsyncProxy||{};c.prototype.postMessage=c.prototype.postMessage;c.prototype.terminate=c.prototype.terminate;a.setSlaveSideCreator=a.Zb;a.setBeforeOperationListener=a.Yb;a.sendUserDataToMaster=a.Xb;a.wrapPromiseFromSlaveSide=a.ub;a.wrapCallbackFromSlaveSide=a.tb;b.create=b.create;d.prototype.setUserDataHandler=d.prototype.$b;d.prototype.terminate=d.prototype.terminate;d.prototype.callFunction=d.prototype.Ba;d.prototype.wrapCallback=
d.prototype.sb;d.prototype.freeCallback=d.prototype.gb;d.getEntryUrl=d.hb;g.prototype.addScriptFromErrorWithStackTrace=g.prototype.Ib;g.prototype.getScriptsForWorkerImport=g.prototype.Mb;e.prototype.startTask=e.prototype.Na;e.prototype.startTaskPromise=e.prototype.bc;e.prototype.getTaskContext=e.prototype.U;f.prototype.hasData=f.prototype.Fa;f.prototype.getLastData=f.prototype.Da;f.prototype.setPriority=f.prototype.qb;f.prototype.unregister=f.prototype.unregister;l.prototype.getTaskOptions=l.prototype.Nb;
h.prototype.onDependencyTaskResult=h.prototype.La;h.prototype.statusUpdated=h.prototype.Oa;h.prototype.getTaskType=h.prototype.Ea;k.prototype.createTaskContext=k.prototype.ia;p.prototype.onDependencyTaskResult=p.prototype.La;p.prototype.statusUpdated=p.prototype.Oa;p.prototype.getTaskType=p.prototype.Ea;r.prototype.createTaskContext=r.prototype.ia;t.prototype.getTaskContext=t.prototype.U}}Z()(aa,y,D,A,C,K,J,M,O,Q,S,U,W,Y);self.AsyncProxy.AsyncProxyFactory=y;
self.AsyncProxy.AsyncProxySlaveSingleton=D;self.AsyncProxy.AsyncProxyMaster=A;self.AsyncProxy.ScriptsToImportPool=C;self.AsyncProxy.DependencyWorkers=K;self.AsyncProxy.WrapperInputRetreiverBase=M;self.AsyncProxy.PromiseTask=O;self.AsyncProxy.PromiseWrapperInputRetreiver=Q;self.AsyncProxy.PromiseDependencyWorkers=S;self.AsyncProxy.SchedulerTask=U;self.AsyncProxy.SchedulerWrapperInputRetreiver=W;self.AsyncProxy.SchedulerDependencyWorkers=Y;var I=function(){function c(){G.call(this,b)}var b={getHashCode:function(a){return a},isEqual:function(a,b){return a===b}};c.prototype=Object.create(G.prototype);return c}();

var t=function(){function b(d,h){this.O=d;this.g=this.w=h;this.s=Array(this.w);this.N=[]}function d(d,h){this.i=d;this.v=h}b.prototype.R=function(d,h){if(0<this.g){--this.g;var b=this.s.pop();void 0===b&&(b=this.O());this.U(d,b,h)}else this.N.push({K:d,c:h})};b.prototype.U=function(b,h,q){b(h,q,new d(this,h))};d.prototype.jobDone=function(){if(0<this.i.N.length){var d=this.i.N.pop();this.i.U(d.K,this.v,d.c)}else this.i.s.push(this.v),++this.i.g};d.prototype.shouldYieldOrAbort=function(){return!1};
d.prototype.tryYield=function(){return!1};return b}();var u=function(){function b(){this.H={h:null,I:this};this.A={o:null,I:this};this.m=0;this.A.h=this.H;this.H.o=this.A}b.prototype.add=function(d,b){if(null===b||void 0===b)b=this.A;this.B(b);++this.m;var h={Y:d,o:b,h:b.h,I:this};h.h.o=h;return b.h=h};b.prototype.remove=function(d){this.B(d);--this.m;d.h.o=d.o;d.o.h=d.h;d.I=null};b.prototype.J=function(d){this.B(d);return d.Y};b.prototype.C=function(){return this.D(this.H)};b.prototype.Z=function(){return this.$(this.A)};b.prototype.D=function(d){this.B(d);
return d.o===this.A?null:d.o};b.prototype.$=function(d){this.B(d);return d.h===this.H?null:d.h};b.prototype.B=function(d){if(d.I!==this)throw"iterator must be of the current LinkedList";};return b}();var w=function(){function b(a,g,c,e){e=e||{};this.O=a;this.w=g;this.l=c;this.f=e.showLog;this.V=e.schedulerName;this.M=e.numNewJobs||20;this.W=e.numJobsBeforeRerankOldPriorities||20;this.g=this.w;this.s=Array(this.w);this.X=e.resourcesGuaranteedForHighPriority||0;this.u=">";this.j=0;this.b=[];this.a=new u;this.P=0}function d(a,g){f(a,"tryDequeueNewJobWithHigherPriority() start",1);for(var c=null,e=g,d=[],k=a.a.C();null!==k;){var b=a.a.D(k),h=a.a.J(k),l=a.l.getPriority(h.c);if(0>l)n(a,k),--a.j,h.F(h.c);
else{if(void 0===e||l>e)e=l,c=k;a.f&&(void 0===d[l]?d[l]=1:++d[l])}k=b}k=null;null!==c&&(k=n(a,c),--a.j);if(a.f){c="tryDequeueNewJobWithHigherPriority(): Jobs list:";for(b=0;b<d.length;++b)void 0!==d[b]&&(c+=d[b]+" jobs of priority "+b+";");f(a,c);null!==k&&f(a,"tryDequeueNewJobWithHigherPriority(): dequeued new job of priority "+e)}m(a);f(a,"tryDequeueNewJobWithHigherPriority() end",-1);return k}function v(a,g,c){f(a,"enqueueNewJob() start",1);++a.j;var e=a.a.C();x(a,g,e);a.f&&f(a,"enqueueNewJob(): enqueued job of priority "+
c);a.a.m<=a.M?(m(a),f(a,"enqueueNewJob() end: _newPendingJobsLinkedList is small enough",-1)):(g=a.a.Z(),g=n(a,g),h(a,g),m(a),f(a,"enqueueNewJob() end: One job moved from new job list to old job list",-1))}function h(a,g){f(a,"enqueueOldJob() start",1);var c=a.l.getPriority(g.c);0>c?(--a.j,g.F(g.c),f(a,"enqueueOldJob() end: job aborted",-1)):(void 0===a.b[c]&&(a.b[c]=[]),a.b[c].push(g),f(a,"enqueueOldJob() end: job enqueued to old job list",-1))}function q(a,g){f(a,"resourceFreed() start",1);++a.g;
var c=y(a);--a.g;c=d(a,c);if(null!==c)m(a),r(a,c,g),m(a),f(a,"resourceFreed() end: new job scheduled",-1);else if(a.j>a.a.m){for(var e,b=a.b.length-1;0<=b;--b){var k=a.b[b];if(void 0!==k&&0!==k.length){for(var h=k.length-1;0<=h;--h){c=k[h];e=a.l.getPriority(c.c);if(e>=b){k.length=h;break}else 0>e?(--a.j,c.F(c.c)):(void 0===a.b[e]&&(a.b[e]=[]),a.b[e].push(c));c=null}if(null!==c)break;k.length=0}}null===c?(a.s.push(g),++a.g,m(a),f(a,"resourceFreed() end: no non-aborted job to schedule",-1)):(a.f&&f(a,
"resourceFreed(): dequeued old job of priority "+e),--a.j,m(a),r(a,c,g),m(a),f(a,"resourceFreed() end: job scheduled",-1))}else a.s.push(g),++a.g,m(a),f(a,"resourceFreed() end: no job to schedule",-1)}function r(a,g,c){f(a,"schedule() start",1);++a.P;if(a.P>=a.W){a.P=0;f(a,"rerankPriorities() start",1);var e=a.b,d=a.a;if(0===e.length)f(a,"rerankPriorities() end: no need to rerank",-1);else{a.b=[];a.a=new u;for(var b=0;b<e.length;++b)if(void 0!==e[b])for(var p=0;p<e[b].length;++p)h(a,e[b][p]);for(b=
d.C();null!==b;)e=d.J(b),h(a,e),b=d.D(b);d="rerankPriorities(): ";for(b=a.b.length-1;0<=b;--b)if(e=a.b[b],void 0!==e){for(a.f&&(d+=e.length+" jobs in priority "+b+";");0<e.length&&a.a.m<a.M;)p=e.pop(),x(a,p);if(a.a.m>=a.M&&!a.f)break}a.f&&f(a,d);m(a);f(a,"rerankPriorities() end: rerank done",-1)}}a.f&&(b=a.l.getPriority(g.c),f(a,"schedule(): scheduled job of priority "+b));g.K(c,g.c,new l(a,c,g.c));f(a,"schedule() end",-1)}function x(a,g,c){f(a,"addJobToLinkedList() start",1);a.a.add(g,c);z(a);f(a,
"addJobToLinkedList() end",-1)}function n(a,g){f(a,"extractJobFromLinkedList() start",1);var c=a.a.J(g);a.a.remove(g);z(a);f(a,"extractJobFromLinkedList() end",-1);return c}function z(a){if(a.f){f(a,"ensureNumberOfNodes() start",1);for(var g=a.a.C(),c=0;null!==g;)++c,g=a.a.D(g);if(c!==a.a.m)throw"Unexpected count of new jobs";f(a,"ensureNumberOfNodes() end",-1)}}function m(a){if(a.f){f(a,"ensurePendingJobsCount() start",1);for(var g=0,c=0;c<a.b.length;++c){var b=a.b[c];void 0!==b&&(g+=b.length)}if(g+
a.a.m!==a.j)throw"Unexpected count of jobs";f(a,"ensurePendingJobsCount() end",-1)}}function y(a){f(a,"getMinimalPriorityToSchedule() start",1);if(a.g<=a.X)return f(a,"getMinimalPriorityToSchedule() end: guarantee resource for high priority is needed",-1),a.aa;f(a,"getMinimalPriorityToSchedule() end: enough resources, no need to guarantee resource for high priority",-1);return 0}function f(a,b,c){a.f&&(-1===c&&(a.u=a.u.substr(1)),void 0!==a.V?console.log(a.u+"PriorityScheduler "+a.V+": "+b):console.log(a.u+
"PriorityScheduler: "+b),1===c&&(a.u+=">"))}function l(a,b,c){this.T=!0;this.i=a;this.v=b;this.G=c}b.prototype.R=function(a,b,c){f(this,"enqueueJob() start",1);var e=this.l.getPriority(b);0>e?(c(b),f(this,"enqueueJob() end: job aborted",-1)):(a={K:a,F:c,c:b},b=y(this),c=null,e>=b&&(f(this,"tryGetFreeResource() start",1),0===this.g?c=null:(--this.g,b=this.s.pop(),void 0===b&&(b=this.O()),m(this),f(this,"tryGetFreeResource() end",-1),c=b)),null!==c?(r(this,a,c),f(this,"enqueueJob() end: job scheduled",
-1)):(v(this,a,e),m(this),f(this,"enqueueJob() end: job pending",-1)))};l.prototype.L=function(){if(!this.T)throw"ResourceScheduler error: Already terminated job";};l.prototype.S=function(){this.T=!1;this.i=this.G=this.v=null};l.prototype.jobDone=function(){this.L();var a=this.i,b=this.v;if(a.f){var c=a.l.getPriority(this.G);f(a,"jobDone() start: job done of priority "+c,1)}q(a,b);m(a);f(a,"jobDone() end",-1);this.S()};l.prototype.shouldYieldOrAbort=function(){this.L();var a=this.i,b=this.G;f(a,"shouldYieldOrAbort() start",
1);var b=a.l.getPriority(b),c;if(!(c=0>b))a:{c=a.a.C();for(f(a,"hasNewJobWithHigherPriority() start",1);null!==c;){var e=a.a.D(c),d=a.a.J(c),h=a.l.getPriority(d.c);if(0>h)n(a,c),--a.j,d.F(d.c);else if(h>b){f(a,"hasNewJobWithHigherPriority() end: returns true",-1);c=!0;break a}c=e}f(a,"hasNewJobWithHigherPriority() end: returns false",-1);c=!1}b=c;f(a,"shouldYieldOrAbort() end",-1);return b};l.prototype.tryYield=function(a,b,c){this.L();var e=this.i,h=this.G,k=this.v;f(e,"tryYield() start",1);var l=
e.l.getPriority(h);if(0>l)b(h),q(e,k),f(e,"tryYield() end: job aborted",-1),a=!0;else{var n=d(e,l);m(e);null===n?(f(e,"tryYield() end: job continues",-1),a=!1):(c(h),v(e,{K:a,F:b,c:h},l),m(e),r(e,n,k),m(e),f(e,"tryYield() end: job yielded",-1),a=!0)}a&&this.S();return a};return b}();self.ResourceScheduler={};self.ResourceScheduler.PriorityScheduler=w;self.ResourceScheduler.LifoScheduler=t;w.prototype.enqueueJob=w.prototype.R;t.prototype.enqueueJob=t.prototype.R;

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.imageDecoderFramework=e()}}(function(){return function e(t,i,r){function s(n,o){if(!i[n]){if(!t[n]){var l="function"==typeof require&&require;if(!o&&l)return l(n,!0);if(a)return a(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[n]={exports:{}};t[n][0].call(c.exports,function(e){var i=t[n][1][e];return s(i?i:e)},c,c.exports,e,t,i,r)}return i[n].exports}for(var a="function"==typeof require&&require,n=0;n<r.length;n++)s(r[n]);return s}({1:[function(e,t,i){"use strict";function r(e){var t={x:e.scene.canvas.width,y:e.scene.canvas.height},i=[];s(0,0,t.x,t.y,i,e,0);var r=Cesium.Rectangle.fromCartographicArray(i);(r.east<r.west||r.north<r.south)&&(r={east:Math.max(r.east,r.west),west:Math.min(r.east,r.west),north:Math.max(r.north,r.south),south:Math.min(r.north,r.south)});var a=n.calculateFrustum2DFromBounds(r,t);return a}function s(e,t,i,r,n,l,h){var c=0;c+=a(e,t,l,n),c+=a(i,t,l,n),c+=a(e,r,l,n),c+=a(i,r,l,n);var u=o;if(!(4===c||h>=u)){++h;var _=(e+i)/2,d=(t+r)/2;s(e,t,_,d,n,l,h),s(e,d,_,r,n,l,h),s(_,t,i,d,n,l,h),s(_,d,i,r,n,l,h)}}function a(e,t,i,r){var s=new Cesium.Cartesian2(e,t),a=i.scene.mapProjection.ellipsoid,n=i.scene.camera.pickEllipsoid(s,a);if(void 0===n)return 0;var o=a.cartesianToCartographic(n);return void 0===o?0:(r.push(o),1)}t.exports=r;var n=e("imagehelperfunctions.js"),o=4},{"imagehelperfunctions.js":12}],2:[function(e,t,i){"use strict";function r(e,t){this._options=t||{},void 0!==this._options.rectangle&&(this._options=JSON.parse(JSON.stringify(t)),this._options.cartographicBounds={west:t.rectangle.west,east:t.rectangle.east,south:t.rectangle.south,north:t.rectangle.north}),this._options.minFunctionCallIntervalMilliseconds=t.minFunctionCallIntervalMilliseconds||100,this._url=t.url,this._targetCanvas=document.createElement("canvas"),this._imageryProviders=[new s(this._targetCanvas),new s(this._targetCanvas)],this._imageryLayerShown=new Cesium.ImageryLayer(this._imageryProviders[0]),this._imageryLayerPending=new Cesium.ImageryLayer(this._imageryProviders[1]),this._canvasUpdatedCallbackBound=this._canvasUpdatedCallback.bind(this),this._isPendingUpdateCallback=!1,this._isWhileReplaceLayerShown=!1,this._pendingPositionRectangle=null,this._image=new a(e,this._canvasUpdatedCallbackBound,this._options),this._image.setTargetCanvas(this._targetCanvas),this._updateFrustumBound=this._updateFrustum.bind(this),this._postRenderBound=this._postRender.bind(this)}t.exports=r;var s=e("canvasimageryprovider.js"),a=e("viewerimagedecoder.js"),n=e("_cesiumfrustumcalculator.js");r.prototype.setExceptionCallback=function(e){this._image.setExceptionCallback(e)},r.prototype.open=function(e){this._widget=e,this._layers=e.scene.imageryLayers,e.scene.postRender.addEventListener(this._postRenderBound),this._image.open(this._url),this._layers.add(this._imageryLayerShown),this._intervalHandle=setInterval(this._updateFrustumBound,500)},r.prototype.close=function(){this._image.close(),clearInterval(this._intervalHandle),this._layers.remove(this._imageryLayerShown),this._widget.removeEventListener(this._postRenderBound),this._isWhileReplaceLayerShown&&(this._isWhileReplaceLayerShown=!1,this._isPendingUpdateCallback=!1,this._layers.remove(this._imageryLayerPending))},r.prototype.getImageryLayers=function(){return[this._imageryLayerShown,this._imageryLayerPending]},r.prototype._updateFrustum=function(){var e=n(this._widget);null!==e&&this._image.updateViewArea(e)},r.prototype._canvasUpdatedCallback=function(e){if(this._isWhileReplaceLayerShown&&(this._isPendingUpdateCallback=!0,this._pendingPositionRectangle=e),null!==e){var t=new Cesium.Rectangle(e.west,e.south,e.east,e.north);this._imageryProviders[0].setRectangle(t),this._imageryProviders[1].setRectangle(t)}this._removeAndReAddLayer()},r.prototype._removeAndReAddLayer=function(){var e=this._layers.indexOf(this._imageryLayerShown);if(0>e)throw"Layer was removed from viewer's layers  without closing layer manager. Use CesiumImageDecoderLayerManager.close() instead";this._isWhileReplaceLayerShown=!0,this._layers.add(this._imageryLayerPending,e)},r.prototype._postRender=function(){if(this._isWhileReplaceLayerShown){this._isWhileReplaceLayerShown=!1,this._layers.remove(this._imageryLayerShown,!1);var e=this._imageryLayerShown;this._imageryLayerShown=this._imageryLayerPending,this._imageryLayerPending=e,this._isPendingUpdateCallback&&(this._isPendingUpdateCallback=!1,this._canvasUpdatedCallback(this._pendingPositionRectangle))}}},{"_cesiumfrustumcalculator.js":1,"canvasimageryprovider.js":3,"viewerimagedecoder.js":19}],3:[function(e,t,i){"use strict";function r(e,t){if(void 0===t&&(t={}),void 0===e)throw new DeveloperError("canvas is required.");this._canvas=e,this._errorEvent=new Event("CanvasImageryProviderStatus"),this._ready=!1;var i=t.credit;"string"==typeof i&&(i=new Credit(i)),this._credit=i}t.exports=r,r.prototype={get tileWidth(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._canvas.width},get tileHeight(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._canvas.height},get maximumLevel(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return 0},get minimumLevel(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0},get tilingScheme(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},get rectangle(){return this._tilingScheme.rectangle},get tileDiscardPolicy(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.")},get errorEvent(){return this._errorEvent},get ready(){return this._ready},get credit(){return this._credit},get hasAlphaChannel(){return!0}},r.prototype.setRectangle=function(e){this._tilingScheme=new Cesium.GeographicTilingScheme({rectangle:e,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1}),this._ready||(this._ready=!0,Cesium.TileProviderError.handleSuccess(this._errorEvent))},r.prototype.getTileWidth=function(){return this.tileWidth},r.prototype.getTileHeight=function(){return this.tileHeight},r.prototype.getMaximumLevel=function(){return this.maximumLevel},r.prototype.getMinimumLevel=function(){return this.minimumLevel},r.prototype.isReady=function(){return this.ready},r.prototype.getCredit=function(){return this.credit},r.prototype.getRectangle=function(){return this.tilingScheme.rectangle},r.prototype.getTilingScheme=function(){return this.tilingScheme},r.prototype.getTileDiscardPolicy=function(){return this.tileDiscardPolicy},r.prototype.getErrorEvent=function(){return this.errorEvent},r.prototype.getHasAlphaChannel=function(){return this.hasAlphaChannel},r.prototype.getTileCredits=function(e,t,i){},r.prototype.requestImage=function(e,t,i){if(!this._ready)throw new DeveloperError("requestImage must not be called before the imagery provider is ready.");return this._canvas},r.prototype.pickFeatures=function(){}},{}],4:[function(e,t,i){"use strict";function r(e,t){var i=t.url;if(this._adaptProportions=t.adaptProportions,this._rectangle=t.rectangle,this._proxy=t.proxy,this._updateFrustumInterval=1e3,this._credit=t.credit,"string"==typeof this._credit&&(this._credit=new Credit(this._credit)),void 0===this._rectangle&&(this._rectangle=Cesium.Rectangle.fromDegrees(-180,-90,180,90)),void 0===this._adaptProportions&&(this._adaptProportions=!0),t=JSON.parse(JSON.stringify(t||{})),t.cartographicBounds={west:this._rectangle.west,east:this._rectangle.east,south:this._rectangle.south,north:this._rectangle.north},void 0===i)throw new DeveloperError("url is required.");this._url=i,this._tilingScheme=void 0,this._tileWidth=0,this._tileHeight=0,this._errorEvent=new Event("ImageDecoderImageryProviderStatus"),this._ready=!1,this._exceptionCallback=null,this._cesiumWidget=null,this._updateFrustumIntervalHandle=null;var r=i;if(void 0!==this._proxy&&(r=this._proxy.getURL(r)),this._image=e,this._levelCalculator=null,this._factory=e.getFactory(),!this._factory.createLevelCalculator)throw"ImageDecoder.createLevelCalculator() is not implemented by factory ctor argument!";this._url=r}function s(e){var t=new Cesium.Rectangle(e.west,e.south,e.east,e.north),i=new Cesium.GeographicTilingScheme({rectangle:t,numberOfLevelZeroTilesX:e.levelZeroTilesX,numberOfLevelZeroTilesY:e.levelZeroTilesY});return i}t.exports=r;var a=(e("workerproxyimagedecoder.js"),e("_cesiumfrustumcalculator.js")),n=e("imagehelperfunctions.js");r.prototype={get url(){return this._url},get proxy(){return this._proxy},get tileWidth(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth},get tileHeight(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight},get maximumLevel(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._numResolutionLevels-1},get minimumLevel(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0},get tilingScheme(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme},get rectangle(){return this._tilingScheme.rectangle},get tileDiscardPolicy(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.")},get errorEvent(){return this._errorEvent},get ready(){return this._ready},get credit(){return this._credit},get hasAlphaChannel(){return!0}},r.prototype.setExceptionCallback=function(e){this._exceptionCallback=e},r.prototype.open=function(e){if(null!==this._updateFrustumIntervalHandle)throw new DeveloperError("Cannot set two parent viewers.");if(void 0===e)throw new DeveloperError("widgetOrViewer should be given. It is needed for frustum calculation for the priority mechanism");this._image.open(this._url).then(this._opened.bind(this))["catch"](this._onException.bind(this)),this._cesiumWidget=e,this._updateFrustumIntervalHandle=setInterval(this._setPriorityByFrustum.bind(this),this._updateFrustumInterval)},r.prototype.close=function(){clearInterval(this._updateFrustumIntervalHandle),this._image.close()},r.prototype.getTileWidth=function(){return this.tileWidth},r.prototype.getTileHeight=function(){return this.tileHeight},r.prototype.getMaximumLevel=function(){return this.maximumLevel},r.prototype.getMinimumLevel=function(){return this.minimumLevel},r.prototype.getUrl=function(){return this.url},r.prototype.getProxy=function(){return this.proxy},r.prototype.isReady=function(){return this.ready},r.prototype.getCredit=function(){return this.credit},r.prototype.getRectangle=function(){return this.tilingScheme.rectangle},r.prototype.getTilingScheme=function(){return this.tilingScheme},r.prototype.getTileDiscardPolicy=function(){return this.tileDiscardPolicy},r.prototype.getErrorEvent=function(){return this.errorEvent},r.prototype.getHasAlphaChannel=function(){return this.hasAlphaChannel},r.prototype.getTileCredits=function(e,t,i){},r.prototype.requestImage=function(e,t,i){function r(e){var t=e.imageData.width,i=e.imageData.height;t>0&&i>0&&P.putImageData(e.imageData,e.xInOriginalRequest,e.yInOriginalRequest)}function s(e){e?x("Fetch request or decode aborted"):(v.drawImage(T,0,0,f,y,g.croppedScreen.minX,g.croppedScreen.minY,g.croppedScreen.maxXExclusive,g.croppedScreen.maxYExclusive),C(p))}if(!this._ready)throw new DeveloperError("requestImage must not be called before the imagery provider is ready.");var a=this,o=Math.pow(2,this._numResolutionLevels-i-1),l=e*this._tileWidth*o,h=t*this._tileHeight*o,c=(e+1)*this._tileWidth*o,u=(t+1)*this._tileHeight*o,_=g.imagePartParams.level,d=this._levelCalculator.getLevelWidth(_),m=this._levelCalculator.getLevelHeight(_),g=n.alignParamsToTilesAndLevel({minX:l,minY:h,maxXExclusive:c,maxYExclusive:u,levelWidth:d,levelHeight:m,screenWidth:this._tileWidth,screenHeight:this._tileHeight},this._image,this._levelCalculator),p=document.createElement("canvas");p.width=this._tileWidth,p.height=this._tileHeight;var v=p.getContext("2d");v.clearRect(0,0,this._tileWidth,this._tileHeight);var f=g.imagePartParams.maxXExclusive-g.imagePartParams.minX,y=g.imagePartParams.maxYExclusive-g.imagePartParams.minY;if(0>=f||0>=y)return p;var T=document.createElement("canvas");T.width=f,T.height=y;var P=T.getContext("2d");P.clearRect(0,0,f,y),g.imagePartParams.quality=this._quality,g.imagePartParams.requestPriorityData={imageRectangle:this._rectangle};var C,x,E=new Promise(function(e,t){C=e,x=t,a._image.requestPixelsProgressive(g.imagePartParams,r,s)});return E},r.prototype._setPriorityByFrustum=function(){if(this._ready){var e=a(this._cesiumWidget,this);null!==e&&(e.imageRectangle=this.getRectangle(),e.exactlevel=null,this._image.setServerRequestPrioritizerData(e),this._image.setDecodePrioritizerData(e))}},r.prototype.pickFeatures=function(){},r.prototype._onException=function(e){null!==this._exceptionCallback&&this._exceptionCallback(e)},r.prototype._opened=function(){if(this._ready)throw"ImageDecoderImageryProvider error: opened() was called more than once!";this._ready=!0,this._levelCalculator=this._factory.createLevelCalculator(this._image._getSizesParams()),this._numResolutionLevels=this._image.getNumResolutionLevelsForLimittedViewer(),this._quality=this._image.getHighestQuality();var e=this._numResolutionLevels-1;this._tileWidth=this._image.getTileWidth(),this._tileHeight=this._image.getTileHeight();var t=(this._image.getImageLevel(),this._image.getImageWidth()),i=this._image.getImageHeight(),r=Math.ceil(t/this._tileWidth)>>e,a=Math.ceil(i/this._tileHeight)>>e;n.fixBounds(this._rectangle,this._image,this._adaptProportions);var o=this._rectangle.east-this._rectangle.west,l=this._rectangle.north-this._rectangle.south,h=1<<e,c=this._tileWidth*r*h,u=this._tileHeight*a*h,_=o*c/t,d=l*u/i,m=this._rectangle.west+_,g=this._rectangle.north-d;this._tilingSchemeParams={west:this._rectangle.west,east:m,south:g,north:this._rectangle.north,levelZeroTilesX:r,levelZeroTilesY:a,maximumLevel:e},this._tilingScheme=s(this._tilingSchemeParams),Cesium.TileProviderError.handleSuccess(this._errorEvent)}},{"_cesiumfrustumcalculator.js":1,"imagehelperfunctions.js":12,"workerproxyimagedecoder.js":18}],5:[function(e,t,i){"use strict";function r(e,t){if(n.call(this),this._options=t||{},this._tileWidth=this._options.tileWidth||256,this._tileHeight=this._options.tileHeight||256,this._showLog=!!this._options.showLog,this._channelStates=[],this._decoders=[],this._image=e,!this._image.getFetchManager)throw"Image.getFetchManager() is not implemented by image ctor argument!";if(!this._image.getDecoderWorkers)throw"Image.getDecoderWorkers() is not implemented by image ctor argument"}t.exports=r;var s=e("imageHelperFunctions.js"),a=e("decodejobspool.js"),n=e("imageparamsretrieverproxy.js");e("setdecoderslavesidecreator.js");r.alignParamsToTilesAndLevel=s.alignParamsToTilesAndLevel,r.prototype=Object.create(n.prototype),r.prototype.getTileWidth=function(){return this._tileWidth},r.prototype.getTileHeight=function(){return this._tileHeight},r.prototype.setServerRequestPrioritizerData=function(e){this._validateComponents(),this._fetchManager.setServerRequestPrioritizerData(e)},r.prototype.setDecodePrioritizerData=function(e){if(this._validateComponents(),r.undefinedVar){if(null===this._decodePrioritizer)throw"No decode prioritizer has been set";this._showLog&&console.log("setDecodePrioritizerData("+e+")");var t=Object.create(e);t.image=this,this._decodePrioritizer.setPrioritizerData(t)}},r.prototype.open=function(e){this._validateComponents();var t=this,i=this._fetchManager.open(e);return i.then(function(e){return t._internalSizesParams=e,{sizesParams:e,applicativeTileWidth:t.getTileWidth(),applicativeTileHeight:t.getTileHeight()}})},r.prototype.close=function(){this._validateComponents();for(var e=0;e<this._decoders.length;++e)this._decoders[e].terminate();return this._fetchManager.close()},r.prototype.createChannel=function(){this._validateComponents(),this._getSizesParams();var e=this;return this._fetchManager.createChannel().then(function(t){return e._channelStates[t]={decodeJobsListenerHandle:null},t})},r.prototype.requestPixels=function(e){function t(t,n){s=t,a=n,o._requestsDecodeJobsPool.forkDecodeJobs(e,i,r)}function i(e){o._copyPixelsToAccumulatedResult(e,n)}function r(e){e?a("Request was aborted due to failure or priority"):s(n)}this._validateComponents(),this._getSizesParams();var s,a,n={},o=this,l=new Promise(t);return l},r.prototype.requestPixelsProgressive=function(e,t,i,r,s){this._validateComponents(),this._getSizesParams();var a,n=null;if(void 0===s)a=this._requestsDecodeJobsPool;else if(a=this._channelsDecodeJobsPool,n=this._channelStates[s],void 0===n)throw"Channel handle does not exist";var o=a.forkDecodeJobs(e,t,i,r);void 0!==s&&(null!==n.decodeJobsListenerHandle&&a.unregisterForkedJobs(n.decodeJobsListenerHandle),n.decodeJobsListenerHandle=o,this._fetchManager.moveChannel(s,e))},r.prototype.reconnect=function(){this._validateComponents(),this._fetchManager.reconnect()},r.prototype.getImage=function(){return this._image},r.prototype._validateComponents=function(){this._fetchManager=this._image.getFetchManager(),this._decodeDependencyWorkers=this._image.getDecoderWorkers(),this._requestsDecodeJobsPool=new a(this._decodeDependencyWorkers,this._tileWidth,this._tileHeight),this._channelsDecodeJobsPool=new a(this._decodeDependencyWorkers,this._tileWidth,this._tileHeight)},r.prototype._getSizesParamsInternal=function(){return this._internalSizesParams},r.prototype._copyPixelsToAccumulatedResult=function(e,t){var i=4,r=e.width*i,s=e.originalRequestWidth*i;if(void 0===t.pixels){var a=s*e.originalRequestHeight;t.pixels=new Uint8Array(a),t.xInOriginalRequest=0,t.yInOriginalRequest=0;var n=e.originalRequestWidth;t.originalRequestWidth=n,t.width=n;var o=e.originalRequestHeight;t.originalRequestHeight=o,t.height=o}t.allRelevantBytesLoaded=e.allRelevantBytesLoaded;for(var l=0,h=e.xInOriginalRequest*i+e.yInOriginalRequest*s,c=0;c<e.height;++c){var u=e.pixels.subarray(l,l+r);t.pixels.set(u,h),l+=r,h+=s}}},{"decodejobspool.js":7,"imageHelperFunctions.js":11,"imageparamsretrieverproxy.js":15,"setdecoderslavesidecreator.js":17}],6:[function(e,t,i){"use strict";function r(e,t){this._isFirstStage=!0,this._listenerHandle=e,this._imagePartParams=t,this._allRelevantBytesLoaded=0;var i=e.imagePartParams;this._offsetX=t.minX-i.minX,this._offsetY=t.minY-i.minY,this._requestWidth=i.maxXExclusive-i.minX,this._requestHeight=i.maxYExclusive-i.minY}t.exports=r;e("linkedlist.js");r.prototype.onData=function(e){this._isFirstStage=!1;var t=e.allRelevantBytesLoaded-this._allRelevantBytesLoaded;this._allRelevantBytesLoaded=e.allRelevantBytesLoaded,this._listenerHandle.allRelevantBytesLoaded+=t;var i={originalRequestWidth:this._requestWidth,originalRequestHeight:this._requestHeight,xInOriginalRequest:this._offsetX,yInOriginalRequest:this._offsetY,imageData:e,allRelevantBytesLoaded:this._listenerHandle.allRelevantBytesLoaded};this._listenerHandle.callback(i)},r.prototype.onTerminated=function(){var e=--this._listenerHandle.remainingDecodeJobs;if(0>e)throw"Inconsistent number of done requests";var t=0===e;t&&(this._listenerHandle.isTerminatedCallbackCalled=!0,this._listenerHandle.terminatedCallback(this._listenerHandle.isAnyDecoderAborted))}},{"linkedlist.js":13}],7:[function(e,t,i){"use strict";function r(e,t,i){this._tileWidth=t,this._tileHeight=i,this._decodeDependencyWorkers=e}function s(e,t,i,r,s){if(void 0===s)return!1;for(var a=0;a<s.length;++a){var n=s[a],o=e>=n.minX&&i<=n.maxXExclusive,l=t>=n.minY&&r<=n.maxYExclusive;if(o&&l)return!0}return!1}t.exports=r;var a=e("decodejob.js");r.prototype.forkDecodeJobs=function(e,t,i,r){var n=e.minX,o=e.minY,l=e.maxXExclusive,h=e.maxYExclusive,c=e.level||0,u=e.quality,_=e.requestPriorityData,d=n%this._tileWidth===0&&o%this._tileHeight===0,m=l%this._tileWidth===0||l===e.levelWidth,g=h%this._tileHeight===0||h===e.levelHeight,p=l>n&&h>o;if(!(d&&m&&g&&p))throw"imagePartParams for decoders is not aligned to tile size or not in valid order";for(var v=Math.ceil((l-n)/this._tileWidth),f=Math.ceil((h-o)/this._tileHeight),y={imagePartParams:e,callback:t,terminatedCallback:i,remainingDecodeJobs:v*f,isAnyDecoderAborted:!1,isTerminatedCallbackCalled:!1,allRelevantBytesLoaded:0,unregisterHandles:[]},T=n;l>T;T+=this._tileWidth)for(var P=Math.min(T+this._tileWidth,e.levelWidth),C=o;h>C;C+=this._tileHeight){var x=Math.min(C+this._tileHeight,e.levelHeight),E=s(T,C,P,x,r);if(E)--y.remainingDecodeJobs;else{var w={minX:T,minY:C,maxXExclusive:P,maxYExclusive:x,levelWidth:e.levelWidth,levelHeight:e.levelHeight,level:c,quality:u,requestPriorityData:_},b=new a(y,w),S=this._decodeDependencyWorkers.startTask(b);y.unregisterHandles.push(S)}}return y.isTerminatedCallbackCalled||0!==y.remainingDecodeJobs||(y.isTerminatedCallbackCalled=!0,y.terminatedCallback(y.isAnyDecoderAborted)),y},r.prototype.unregisterForkedJobs=function(e){if(0!==e.remainingDecodeJobs)for(var t=0;t<e.unregisterHandles.length;++t)e.unregisterHandles[t].unregister()}},{"decodejob.js":6}],8:[function(e,t,i){"use strict";function r(e,t,i,s,a){this._fetcher=e,this._scheduler=t,this._scheduledJobsList=i,this._scheduledJobsListIterator=null,this._terminatedListeners=[],this._imagePartParams=null,this._state=r.FETCH_STATUS_WAIT_FOR_FETCH_CALL,this._isChannel=s===r.FETCH_TYPE_CHANNEL,this._contextVars=a,this._isOnlyWaitForData=s===r.FETCH_TYPE_ONLY_WAIT_FOR_DATA,this._useScheduler=s===r.FETCH_TYPE_REQUEST,this._resource=null,this._fetchHandle=null,this._fetchTerminatedBound=this._fetchTerminated.bind(this),s===r.FETCH_TYPE_CHANNEL?this._movableFetchState={}:this._movableFetchState=null}function s(e,t){if(null!==t._fetchHandle||null!==t._resource)throw"Unexpected restart of already started request";if(t._state===r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT)return void t._fetchTerminated(!0);if(t._state!==r.FETCH_STATUS_REQUEST_WAIT_FOR_SCHEDULE)throw"Unexpected state on schedule: "+t._state;t._resource=e,null!==e&&(t._scheduledJobsListIterator=t._scheduledJobsList.add(t)),t._startFetch()}function a(e,t){if(t.isChannel)throw"Unexpected call to continueYieldedRequest on channel";if(t._state===r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT||t._state===r.FETCH_STATUS_UNEXPECTED_FAILURE)return void t._scheduler.jobDone(e,t);if(t._state!==r.FETCH_STATUS_REQUEST_YIELDED)throw"Unexpected request state on continue: "+t._state;t._state=r.FETCH_STATUS_ACTIVE,t._resource=e,t._scheduledJobsListIterator=t._scheduledJobsList.add(t),t._fetchHandle.resume()}function n(e){if(e._resource=null,e._scheduledJobsList.remove(e._scheduledJobsListIterator),e.state!==r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD)throw e._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,"Unexpected request state on yield process: "+e._state;e._state=r.FETCH_STATUS_REQUEST_YIELDED}function o(e){e._resource=null,e._fetchTerminated(!0)}t.exports=r,r.FETCH_TYPE_REQUEST=1,r.FETCH_TYPE_CHANNEL=2,r.FETCH_TYPE_ONLY_WAIT_FOR_DATA=3,r.FETCH_STATUS_WAIT_FOR_FETCH_CALL=1,r.FETCH_STATUS_REQUEST_WAIT_FOR_SCHEDULE=2,r.FETCH_STATUS_ACTIVE=3,r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD=4,r.FETCH_STATUS_REQUEST_YIELDED=6,r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT=8,r.FETCH_STATUS_REQUEST_TERMINATED=9,r.FETCH_STATUS_UNEXPECTED_FAILURE=10,r.prototype.fetch=function(e){if(this._isChannel)return this._imagePartParams=e,void this._startFetch();if(null!==this._imagePartParams)throw'Cannot fetch twice on fetch type of "request"';if(this._state!==r.FETCH_STATUS_WAIT_FOR_FETCH_CALL)throw this._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,"Unexpected state on fetch(): "+this._state;return this._imagePartParams=e,this._state=r.FETCH_STATUS_REQUEST_WAIT_FOR_SCHEDULE,this._useScheduler?void this._scheduler.enqueueJob(s,this,o):void s(null,this)},r.prototype.manualAbortRequest=function(){switch(this._state){case r.FETCH_STATUS_REQUEST_TERMINATED:case r.FETCH_STATUS_UNEXPECTED_FAILURE:return;case r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT:throw"Double call to manualAbortRequest()";case r.FETCH_STATUS_ACTIVE:var e=this;this._state=r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT,e._isOnlyWaitForData?e._fetchTerminated(!0):this._fetchHandle.stopAsync().then(function(){e._fetchTerminated(!0)});break;case r.FETCH_STATUS_WAIT_FOR_FETCH_CALL:return void(this._state=r.FETCH_STATUS_REQUEST_TERMINATED);case r.FETCH_STATUS_REQUEST_WAIT_FOR_SCHEDULE:case r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD:case r.FETCH_STATUS_REQUEST_YIELDED:this._state=r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT;break;default:throw"Unknown state in manualAbortRequest() implementation: "+this._state}},r.prototype.getContextVars=function(e){return this._contextVars},r.prototype.on=function(e,t){switch(e){case"terminated":this._terminatedListeners.push(t);break;default:throw"Unexpected event "+e}},r.prototype.setIsProgressive=function(e){this._isProgressive=e,null!==this._fetchHandle&&this._fetchHandle.setIsProgressive(e)},r.prototype.getIsProgressive=function(){return this._isProgressive},r.prototype._startFetch=function(){var e=this._state;this._state=r.FETCH_STATUS_ACTIVE,this._isOnlyWaitForData?this._fetchHandle=this._extractAlreadyFetchedData():this._isChannel?e!==r.FETCH_STATUS_WAIT_FOR_FETCH_CALL?this._fetchHandle=this._fetcher.moveFetch(this._imagePartParams,this._movableFetchState):this._fetchHandle=this._fetcher.startMovableFetch(this._imagePartParams,this._movableFetchState):this._fetchHandle=this._fetcher.fetch(this._imagePartParams),this._fetchHandle.on("terminated",this._fetchTerminatedBound),this._fetchHandle.setIsProgressive(this._isProgressive)},r.prototype._fetchTerminated=function(e){switch(this._state){case r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT:break;case r.FETCH_STATUS_ACTIVE:case r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD:if(e)throw this._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,"Unexpected abort when fetch is active";break;default:throw"Unexpected state on fetch terminated: "+this._state}if(null!==this._resource){if(e)throw"Unexpected request termination without resource allocated";this._scheduledJobsList.remove(this._scheduledJobsListIterator),this._scheduler.jobDone(this._resource,this),this._resource=null}else if(!e&&this._useScheduler)throw"Job expected to have resource on successful termination";if(!this._isChannel){this._state=r.FETCH_STATUS_REQUEST_TERMINATED;for(var t=0;t<this._terminatedListeners.length;++t)this._terminatedListeners[t](this._contextVars,e)}null!==this._fetchHandle&&this._state!==r.FETCH_STATUS_UNEXPECTED_FAILURE&&(this._fetchHandle.dispose(),this._fetchHandle=null)},r.prototype.checkIfShouldYield=function(){try{if(!this._useScheduler||this._state===r.FETCH_STATUS_REQUEST_TERMINATED)return;if(null===this._resource)throw"No resource allocated but fetch callback called";if(!this._scheduler.shouldYieldOrAbort(this._resource))return;this._state=r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD;var e=this;this._fetchHandle.stopAsync().then(function(){if(e._fetchState===r.FETCH_STATUS_REQUEST_ABOUT_TO_ABORT)return void e._fetchTerminated(!0);var t=e._scheduler.tryYield(a,e,o,n,e._resource);if(!t){if(e._state!==r.FETCH_STATUS_REQUEST_ABOUT_TO_YIELD)throw"Unexpected state on tryYield() false: "+e._state;e._state=r.FETCH_STATUS_ACTIVE,e._fetchHandle.resume()}})["catch"](function(){e._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,o(e)})}catch(t){this._state=r.FETCH_STATUS_UNEXPECTED_FAILURE,o(this)}},Object.defineProperty(r.prototype,"imagePartParams",{get:function(){return this._imagePartParams}})},{}],9:[function(e,t,i){"use strict";function r(e,t){l.call(this);var i=t.serverRequestsLimit||5;if(this._fetcher=e,this._internalSizesParams=null,this._showLog=t.showLog,this._showLog)throw"showLog is not supported on this browser";var r=n.createScheduler(t.showLog,t.serverRequestPrioritizer,"serverRequest",a,i);this._serverRequestPrioritizer=r.prioritizer,this._scheduler=r.scheduler,this._channelHandleCounter=0,this._channelHandles=[],this._requestById=[],this._scheduledJobsList=new h}function s(e,t){e.terminatedCallback.call(e.callbackThis,t),delete e.self._requestById[e.requestId]}function a(){return{}}t.exports=r;var n=e("imagehelperfunctions.js"),o=e("fetchjob.js"),l=e("imageparamsretrieverproxy.js"),h=e("linkedlist.js");r.prototype=Object.create(l.prototype),r.prototype.open=function(e,t){var i=this._fetcher.open(t,{isReturnPromise:!0}),r=this;return i.then(function(e){return r._fetcher=e.fetcher,r._internalSizesParams=e.sizesParams,e.sizesParams})},r.prototype.on=function(e,t){this._fetcher.on(e,t)},r.prototype.close=function(){return this._fetcher.close({isReturnPromise:!0})},r.prototype.setIsProgressiveRequest=function(e,t){var i=this._requestById[e];return void 0===i?null:void i.setIsProgressive(t)},r.prototype.createChannel=function(){return new Promise(function(e,t){var i=++this._channelHandleCounter;this._channelHandles[i]=new o(this._fetcher,this._scheduler,this._scheduledJobsList,o.FETCH_TYPE_CHANNEL,null),e(i)})},r.prototype.moveChannel=function(e,t){var i=this._channelHandles[e];i.fetch(t)},r.prototype.createRequest=function(e,t,i,r,a){var n={progressiveStagesDone:0,isLastCallbackCalledWithoutLowQualityLimit:!1,callbackThis:t,terminatedCallback:i,requestId:a,fetchJob:null,self:this},l=r?o.FETCH_TYPE_ONLY_WAIT_FOR_DATA:o.FETCH_TYPE_REQUEST,h=new o(this._fetcher,this._scheduler,this._scheduledJobsList,l,n);if(n.fetchJob=h,void 0!==this._requestById[a])throw"Duplication of requestId "+a;void 0!==a&&(this._requestById[a]=h),h.on("terminated",s),h.fetch(e),this._yieldFetchJobs()},r.prototype.manualAbortRequest=function(e){var t=this._requestById[e];void 0!==t&&(t.manualAbortRequest(),delete this._requestById[e])},r.prototype.reconnect=function(){this._fetcher.reconnect()},r.prototype.setServerRequestPrioritizerData=function(e){if(null===this._serverRequestPrioritizer)throw"No serverRequest prioritizer has been set";this._showLog&&console.log("setServerRequestPrioritizerData("+e+")"),e.image=this,this._serverRequestPrioritizer.setPrioritizerData(e),this._yieldFetchJobs()},r.prototype._getSizesParamsInternal=function(){return this._internalSizesParams},r.prototype._yieldFetchJobs=function(){for(var e=this._scheduledJobsList.getFirstIterator();null!==e;){var t=this._scheduledJobsList.getValue(e);e=this._scheduledJobsList.getNextIterator(e),t.checkIfShouldYield()}}},{"fetchjob.js":8,"imagehelperfunctions.js":12,"imageparamsretrieverproxy.js":15,"linkedlist.js":13}],10:[function(e,t,i){"use strict";function r(e,t){this._frustumData=null,this._isAbortRequestsNotInFrustum=e,this._isPrioritizeLowProgressiveStage=t}t.exports=r;var s=-1,a=0,n=1,o=2,l=3,h=4,c=5,u=6,_=7,d=5,m=13;Math.log(2);Object.defineProperty(r.prototype,"minimalLowQualityPriority",{get:function(){return h+d}}),r.prototype.setPrioritizerData=function(e){this._frustumData=e},r.prototype.getPriority=function(e){var t=e.imagePartParams;if(t.requestPriorityData.overrideHighestPriority)return m;var i=this._getPriorityInternal(t),r=i>=h;if(this._isAbortRequestsNotInFrustum&&!r)return s;var a=0;return this._isPrioritizeLowProgressiveStage&&r&&(a=0===e.progressiveStagesDone?d:1===e.progressiveStagesDone?1:0),i+a},r.prototype._getPriorityInternal=function(e){if(null===this._frustumData)return a;if(void 0===this._frustumData.imageRectangle)throw"No imageRectangle information passed in setPrioritizerData";var t=this._frustumData.exactlevel;if(void 0===this._frustumData.exactlevel)throw"No exactlevel information passed in setPrioritizerData. Use null if unknown";
var i,r=this._pixelToCartographicX(e.minX,e),s=this._pixelToCartographicX(e.maxXExclusive,e),d=this._pixelToCartographicY(e.minY,e),m=this._pixelToCartographicY(e.maxYExclusive,e),g=e.maxXExclusive-e.minX,p=e.maxYExclusive-e.minY,v=e.level||0;if(null===t){var f=g/(s-r),y=p/(d-m),T=Math.max(f,y),P=this._frustumData.resolution;if(i=T/P,i>2)return n}else if(t>v)return n;var C=this._frustumData.rectangle,x=Math.max(C.west,r),E=Math.min(C.east,s),w=Math.max(C.south,m),b=Math.min(C.north,d),S=E-x,H=b-w;if(0>S||0>H)return o;if(null!==t){if(v>t)return l}else if(v>0&&.25>i)return l;var I=S*H,R=(s-r)*(d-m),L=I/R;return L>.99?_:L>.7?u:L>.3?c:h},r.prototype._pixelToCartographicX=function(e,t){var i=e/t.levelWidth,r=this._frustumData.imageRectangle,s=r.east-r.west,a=r.west+i*s;return a},r.prototype._pixelToCartographicY=function(e,t,i){var r=e/t.levelHeight,s=this._frustumData.imageRectangle,a=s.north-s.south,n=s.north-r*a;return n}},{}],11:[function(e,t,i){"use strict";function r(e,t){var i=t.x*t.x+t.y*t.y,r=e.east-e.west,s=e.north-e.south,a=r*r+s*s,n=Math.sqrt(i/a),o={resolution:n,rectangle:e,screenSize:t};return o}function s(e,t,i,r,s){var a,n;if(void 0===t)a=null,n=new ResourceScheduler.LifoScheduler(r,s);else{var l=!1;"frustum"===t?(l=!0,a=new o):"frustumOnly"===t?(l=!0,a=new o(!0,!0)):a=t;var h={schedulerName:i,showLog:e};l&&(h.resourceGuaranteedForHighPriority=s-2,h.highPriorityToGuaranteeResource=a.minimalLowQualityPriority),n=new ResourceScheduler.PriorityScheduler(r,s,a,h)}return{prioritizer:a,scheduler:n}}function a(e,t,i){if(i){var r=e.east-e.west,s=e.north-e.south,a=t.getImageWidth()/t.getImageHeight(),n=r/s;if(n>a){var o=r;r=s*a;var l=o-r;e.east-=l/2,e.west+=l/2}else{var h=s;s=r/a;var c=h-s;e.north-=c/2,e.south+=c/2}}}function n(e,t,i){var r=t.getTileWidth(),s=t.getTileHeight(),a=e.minX,n=e.minY,o=e.maxXExclusive,l=e.maxYExclusive,h=e.screenWidth,c=e.screenHeight,u=o>a&&l>n;if(!u)throw"Parameters order is invalid";var _=t.getImageWidth(),d=t.getImageHeight();if(0>o||a>=_||0>l||n>=d)return null;var m=i.getLevel(e),g=i.getLevelWidth(m),p=i.getLevelHeight(m),v=_/g,f=d/p,y=Math.floor(a/(v*r)),T=Math.floor(n/(f*s)),P=Math.ceil(o/(v*r)),C=Math.ceil(l/(f*s)),x=y*r,E=T*s,w=P*r,b=C*s,S=Math.max(0,Math.min(g,x)),H=Math.max(0,Math.min(p,E)),I=Math.max(0,Math.min(g,w)),R=Math.max(0,Math.min(p,b)),L=h/(w-x),D=c/(b-E),U={minX:S,minY:H,maxXExclusive:I,maxYExclusive:R,levelWidth:g,levelHeight:p,level:m},A={minX:S*v,minY:H*f,maxXExclusive:I*v,maxYExclusive:R*f},F={minX:Math.floor((S-x)*L),minY:Math.floor((H-E)*D),maxXExclusive:Math.ceil((I-x)*L),maxYExclusive:Math.ceil((R-E)*D)};return{imagePartParams:U,positionInImage:A,croppedScreen:F}}var o=e("frustumrequestsprioritizer.js");t.exports={calculateFrustum2DFromBounds:r,createScheduler:s,fixBounds:a,alignParamsToTilesAndLevel:n}},{"frustumrequestsprioritizer.js":10}],12:[function(e,t,i){arguments[4][11][0].apply(i,arguments)},{dup:11,"frustumrequestsprioritizer.js":10}],13:[function(e,t,i){"use strict";function r(){this._first={_prev:null,_parent:this},this._last={_next:null,_parent:this},this._count=0,this._last._prev=this._first,this._first._next=this._last}t.exports=r,r.prototype.add=function(e,t){null!==t&&void 0!==t||(t=this._last),this._validateIteratorOfThis(t),++this._count;var i={_value:e,_next:t,_prev:t._prev,_parent:this};return i._prev._next=i,t._prev=i,i},r.prototype.remove=function(e){this._validateIteratorOfThis(e),--this._count,e._prev._next=e._next,e._next._prev=e._prev,e._parent=null},r.prototype.getValue=function(e){return this._validateIteratorOfThis(e),e._value},r.prototype.getFirstIterator=function(){var e=this.getNextIterator(this._first);return e},r.prototype.getLastIterator=function(){var e=this.getPrevIterator(this._last);return e},r.prototype.getNextIterator=function(e){return this._validateIteratorOfThis(e),e._next===this._last?null:e._next},r.prototype.getPrevIterator=function(e){return this._validateIteratorOfThis(e),e._prev===this._first?null:e._prev},r.prototype.getCount=function(){return this._count},r.prototype._validateIteratorOfThis=function(e){if(e._parent!==this)throw"iterator must be of the current LinkedList"}},{}],14:[function(e,t,i){"use strict";function r(){AsyncProxy.AsyncProxySlave.setSlaveSideCreator(function(){var e=new Array(arguments.length+1);e[0]=null;for(var t=0;t<arguments.length;++t)e[t+1]=arguments[t];var i=new(Function.prototype.bind.apply(imageDecoderFramework.ImageDecoder,e));return i})}e("imagedecoder.js");t.exports.getScriptUrl=function(){return a};var s=new Blob(["(",r.toString(),")()"],{type:"application/javascript"}),a=URL.createObjectURL(s)},{"imagedecoder.js":5}],15:[function(e,t,i){"use strict";function r(){this._sizesParams=null}t.exports=r,r.prototype.getImageLevel=function(){var e=this._getSizesParams();return e.imageLevel},r.prototype.getImageWidth=function(){var e=this._getSizesParams();return e.imageWidth},r.prototype.getImageHeight=function(){var e=this._getSizesParams();return e.imageHeight},r.prototype.getNumResolutionLevelsForLimittedViewer=function(){var e=this._getSizesParams();return e.numResolutionLevelsForLimittedViewer},r.prototype.getLowestQuality=function(){var e=this._getSizesParams();return e.lowestQuality},r.prototype.getHighestQuality=function(){var e=this._getSizesParams();return e.highestQuality},r.prototype._getSizesParams=function(){if(!this._sizesParams){if(this._sizesParams=this._getSizesParamsInternal(),!this._sizesParams)throw"getSizesParamsInternal() returned falsy value; Maybe image not ready yet?";if(void 0===this._sizesParams.imageLevel)throw"getSizesParamsInternal() result has no imageLevel property";if(void 0===this._sizesParams.imageWidth)throw"getSizesParamsInternal() result has no imageWidth property";if(void 0===this._sizesParams.imageHeight)throw"getSizesParamsInternal() result has no imageHeight property";if(void 0===this._sizesParams.numResolutionLevelsForLimittedViewer)throw"getSizesParamsInternal() result has no numResolutionLevelsForLimittedViewer property";if(void 0===this._sizesParams.lowestQuality)throw"getSizesParamsInternal() result has no lowestQuality property";if(void 0===this._sizesParams.highestQuality)throw"getSizesParamsInternal() result has no highestQuality property"}return this._sizesParams},r.prototype._getSizesParamsInternal=function(){throw"ImageParamsRetrieverProxy inheritor did not implement _getSizesParamsInternal()"}},{}],16:[function(e,t,i){"use strict";function r(){function e(e,i,r){if("callback"===e&&"statusCallback"===i){if(t||!r[0].isReady)return null;var s={sizesParams:this._getSizesParams()};this.getTileWidth&&(s.applicativeTileWidth=this.getTileWidth()),this.getTileHeight&&(s.applicativeTileHeight=this.getTileHeight()),AsyncProxy.AsyncProxySlave.sendUserDataToMaster(s),t=!0}}var t=!1;AsyncProxy.AsyncProxySlave.setBeforeOperationListener(e)}t.exports.getScriptUrl=function(){return a};var s=new Blob(["(",r.toString(),")()"],{type:"application/javascript"}),a=URL.createObjectURL(s)},{}],17:[function(e,t,i){"use strict";function r(){AsyncProxy.AsyncProxySlave.setSlaveSideCreator(function(e){var t=imageDecoderFramework.Internals.imageHelperFunctions.getImageImplementation(e.imageImplementationClassName);return t.createPixelsDecoder()})}t.exports.getScriptUrl=function(){return a};var s=(e("imagehelperfunctions.js"),new Blob(["(",r.toString(),")()"],{type:"application/javascript"})),a=URL.createObjectURL(s)},{"imagehelperfunctions.js":12}],18:[function(e,t,i){"use strict";function r(e,t){o.call(this),this._imageWidth=null,this._imageHeight=null,this._tileWidth=0,this._tileHeight=0;var i=s.createInternalOptions(e,t),r=[e,i],l=s.getScriptsForWorkerImport(this._imageImplementation,t);l=l.concat([a.getScriptUrl(),n.getScriptUrl()]),this._workerHelper=new AsyncProxy.AsyncProxyMaster(l,"imageDecoderFramework.ImageDecoder",r);var h=this._imageOpened.bind(this);this._workerHelper.setUserDataHandler(h)}t.exports=r;var s=e("imagehelperfunctions.js"),a=e("sendimageparameterstomaster.js"),n=e("createimagedecoderonslaveside.js"),o=e("imageparamsretrieverproxy.js");r.prototype=Object.create(o.prototype),r.prototype.getTileWidth=function(){return this._getSizesParams(),this._tileWidth},r.prototype.getTileHeight=function(){return this._getSizesParams(),this._tileHeight},r.prototype.open=function(e){var t=this;return this._workerHelper.callFunction("open",[e],{isReturnPromise:!0}).then(function(e){return t._imageOpened(e),e})},r.prototype.close=function(){return this._workerHelper.callFunction("close",[],{isReturnPromise:!0})},r.prototype.createChannel=function(){this._workerHelper.callFunction("createChannel",[],{isReturnPromise:!0})},r.prototype.requestPixels=function(e){var t=["data","buffer"],i=[t],r=[e];this._workerHelper.callFunction("requestPixels",r,{isReturnPromise:!0,pathsToTransferablesInPromiseResult:i})},r.prototype.requestPixelsProgressive=function(e,t,i,r,s){function a(e){c._workerHelper.freeCallback(o),i(e)}var n,o=this._workerHelper.wrapCallback(t,"requestPixelsProgressiveCallback",{isMultipleTimeCallback:!0,pathsToTransferables:n}),l=this._workerHelper.wrapCallback(a,"requestPixelsProgressiveTerminatedCallback",{isMultipleTimeCallback:!1}),h=[e,o,l,r,s];this._workerHelper.callFunction("requestPixelsProgressive",h);var c=this},r.prototype.setServerRequestPrioritizerData=function(e){this._workerHelper.callFunction("setServerRequestPrioritizerData",[e],{isSendImmediately:!0})},r.prototype.setDecodePrioritizerData=function(e){this._workerHelper.callFunction("setDecodePrioritizerData",[e],{isSendImmediately:!0})},r.prototype.reconnect=function(){this._workerHelper.callFunction("reconnect")},r.prototype.alignParamsToTilesAndLevel=function(e){return s.alignParamsToTilesAndLevel(e,this)},r.prototype._imageOpened=function(e){this._internalSizesParams=e.sizesParams,this._tileWidth=e.applicativeTileWidth,this._tileHeight=e.applicativeTileHeight,this._getSizesParams()},r.prototype._getSizesParamsInternal=function(){return this._internalSizesParams}},{"createimagedecoderonslaveside.js":14,"imagehelperfunctions.js":12,"imageparamsretrieverproxy.js":15,"sendimageparameterstomaster.js":16}],19:[function(e,t,i){"use strict";function r(e,t,i){if(this._canvasUpdatedCallback=t,this._adaptProportions=i.adaptProportions,this._cartographicBounds=i.cartographicBounds,this._isMainImageOnUi=i.isMainImageOnUi,this._showLog=i.showLog,this._allowMultipleChannelsInSession=i.allowMultipleChannelsInSession,this._minFunctionCallIntervalMilliseconds=i.minFunctionCallIntervalMilliseconds,this._overviewResolutionX=i.overviewResolutionX||100,this._overviewResolutionY=i.overviewResolutionY||100,this._lastRequestIndex=0,this._pendingUpdateViewArea=null,this._regions=[],this._targetCanvas=null,this._callPendingCallbacksBound=this._callPendingCallbacks.bind(this),this._createdChannelBound=this._createdChannel.bind(this),this._pendingCallbacksIntervalHandle=0,this._pendingCallbackCalls=[],this._canShowDynamicRegion=!1,void 0===this._cartographicBounds&&(this._cartographicBounds={west:-175,east:175,south:-85,north:85}),void 0===this._adaptProportions&&(this._adaptProportions=!0),this._decoder=e,this._image=e.getImage(),!this._image.getLevelCalculator)throw"Image.getLevelCalculator() is not implemented by image ctor argument!"}t.exports=r;var s=(e("imagedecoder.js"),e("workerproxyimagedecoder.js"),e("imagehelperfunctions.js")),a=1,n=2,o=0,l=1;r.prototype.setExceptionCallback=function(e){this._exceptionCallback=e},r.prototype.open=function(e){return this._decoder.open(e).then(this._opened.bind(this))["catch"](this._exceptionCallback)},r.prototype.close=function(){var e=this._decoder.close();return e["catch"](this._exceptionCallback),this._isReady=!1,this._canShowDynamicRegion=!1,this._targetCanvas=null,e},r.prototype.setTargetCanvas=function(e){this._targetCanvas=e},r.prototype.updateViewArea=function(e){if(null===this._targetCanvas)throw"Cannot update dynamic region before setTargetCanvas()";if(!this._canShowDynamicRegion)return void(this._pendingUpdateViewArea=e);var t=e.rectangle,i=e.screenSize,r={minX:t.west*this._scaleX+this._translateX,minY:t.north*this._scaleY+this._translateY,maxXExclusive:t.east*this._scaleX+this._translateX,maxYExclusive:t.south*this._scaleY+this._translateY,screenWidth:i.x,screenHeight:i.y},a=s.alignParamsToTilesAndLevel(r,this._decoder,this._levelCalculator),n=null===a;if(!n){a.imagePartParams.quality=this._quality;var o=void 0!==this._dynamicFetchParams&&this._isImagePartsEqual(a.imagePartParams,this._dynamicFetchParams.imagePartParams);if(!o){e.imageRectangle=this._cartographicBoundsFixed,e.exactlevel=a.imagePartParams.level,this._decoder.setDecodePrioritizerData(e),this._decoder.setServerRequestPrioritizerData(e),this._dynamicFetchParams=a;var h=!1,c=!this._allowMultipleChannelsInSession;this._fetch(l,a,h,c)}}},r.prototype.getBounds=function(){if(!this._isReady)throw"ViewerImageDecoder error: Image is not ready yet";return this._cartographicBoundsFixed},r.prototype._isImagePartsEqual=function(e,t){var i=void 0!==this._dynamicFetchParams&&e.minX===t.minX&&e.minY===t.minY&&e.maxXExclusive===t.maxXExclusive&&e.maxYExclusive===t.maxYExclusive&&e.level===t.level;return i},r.prototype._fetch=function(e,t,i,r){function s(i){E._tilesDecodedCallback(e,t,f,i)}function a(r){r&&l.requestPriorityData.overrideHighestPriority&&E._decoder.requestPixelsProgressive(t.imagePartParams,s,a,h),E._fetchTerminatedCallback(e,t.imagePartParams.requestPriorityData,r,i)}var n=++this._lastRequestIndex,l=t.imagePartParams;l.requestPriorityData=l.requestPriorityData||{},l.requestPriorityData.requestIndex=n;var h,c=t.positionInImage.minX,u=t.positionInImage.minY,_=t.positionInImage.maxXExclusive,d=t.positionInImage.maxYExclusive,m=(c-this._translateX)/this._scaleX,g=(_-this._translateX)/this._scaleX,p=(u-this._translateY)/this._scaleY,v=(d-this._translateY)/this._scaleY,f={west:m,east:g,north:p,south:v},y=!1,T=this._regions[e];if(void 0!==T){var P=l.level,C=T.imagePartParams.level;if(y=P===C,y&&T.donePartParams&&(h=[T.donePartParams]),e!==o){var x=this._checkIfRepositionNeeded(T,l,f);x&&this._notifyNewPendingCalls()}}var E=this,w=r?this._channelHandle:void 0;this._decoder.requestPixelsProgressive(t.imagePartParams,s,a,h,w)},r.prototype._fetchTerminatedCallback=function(e,t,i,r){var s=this._regions[e];void 0!==s&&(t.overrideHighestPriority||t.requestIndex===this._lastRequestIndex)&&(s.isDone=!i&&this._isReady,s.isDone&&(s.donePartParams=s.imagePartParams),r&&this._decoder.createChannel().then(this._createdChannelBound))},r.prototype._createdChannel=function(e){this._channelHandle=e,this._startShowingDynamicRegion()},r.prototype._startShowingDynamicRegion=function(){this._canShowDynamicRegion=!0,null!==this._pendingUpdateViewArea&&(this.updateViewArea(this._pendingUpdateViewArea),this._pendingUpdateViewArea=null)},r.prototype._tilesDecodedCallback=function(e,t,i,r){if(this._isReady){var s=this._regions[e];if(void 0===s)switch(s={},this._regions[e]=s,e){case l:s.canvas=this._targetCanvas;break;case o:s.canvas=document.createElement("canvas");break;default:throw"Unexpected regionId "+e}var n=t.imagePartParams;!n.requestPriorityData.overrideHighestPriority&&n.requestPriorityData.requestIndex<s.currentDisplayRequestIndex||(this._checkIfRepositionNeeded(s,n,i),this._pendingCallbackCalls.push({type:a,region:s,decoded:r}),this._notifyNewPendingCalls())}},r.prototype._checkIfRepositionNeeded=function(e,t,i){var r=e.imagePartParams,s=e.donePartParams,a=t.level,o=void 0===r||r.minX!==t.minX||r.minY!==t.minY||r.maxXExclusive!==t.maxXExclusive||r.maxYExclusive!==t.maxYExclusive||r.level!==a;if(!o)return!1;var l,h,c,u,_,d=!1;void 0!==r&&(u=t.levelWidth/r.levelWidth,_=t.levelHeight/r.levelHeight,h={minX:Math.max(r.minX*u,t.minX),minY:Math.max(r.minY*_,t.minY),maxX:Math.min(r.maxXExclusive*u,t.maxXExclusive),maxY:Math.min(r.maxYExclusive*_,t.maxYExclusive)},d=h.maxX>h.minX&&h.maxY>h.minY),d&&(l={fromX:h.minX/u-r.minX,fromY:h.minY/_-r.minY,fromWidth:(h.maxX-h.minX)/u,fromHeight:(h.maxY-h.minY)/_,toX:h.minX-t.minX,toY:h.minY-t.minY,toWidth:h.maxX-h.minX,toHeight:h.maxY-h.minY},s&&r.level===a&&(c={minX:Math.max(s.minX,t.minX),minY:Math.max(s.minY,t.minY),maxXExclusive:Math.min(s.maxXExclusive,t.maxXExclusive),maxYExclusive:Math.min(s.maxYExclusive,t.maxYExclusive)})),e.imagePartParams=t,e.isDone=!1,e.currentDisplayRequestIndex=t.requestPriorityData.requestIndex;var m={type:n,region:e,position:i,donePartParams:c,copyData:l,pixelsWidth:t.maxXExclusive-t.minX,pixelsHeight:t.maxYExclusive-t.minY};return this._pendingCallbackCalls.push(m),!0},r.prototype._notifyNewPendingCalls=function(){this._isNearCallbackCalled||this._callPendingCallbacks()},r.prototype._callPendingCallbacks=function(){if(0===this._pendingCallbackCalls.length||!this._isReady)return void(this._isNearCallbackCalled=!1);this._isNearCallbackCalled&&clearTimeout(this._pendingCallbacksIntervalHandle),void 0!==this._minFunctionCallIntervalMilliseconds&&(this._pendingCallbacksIntervalHandle=setTimeout(this._callPendingCallbacksBound,this._minFunctionCallIntervalMilliseconds),this._isNearCallbackCalled=!0);for(var e=null,t=0;t<this._pendingCallbackCalls.length;++t){var i=this._pendingCallbackCalls[t];if(i.type===n)this._repositionCanvas(i),e=i.position;else{if(i.type!==a)throw"Internal ViewerImageDecoder Error: Unexpected call type "+i.type;this._pixelsUpdated(i)}}this._pendingCallbackCalls.length=0,this._canvasUpdatedCallback(e)},r.prototype._pixelsUpdated=function(e){var t=e.region,i=e.decoded;if(0!==i.imageData.width&&0!==i.imageData.height){var r=i.xInOriginalRequest,s=i.yInOriginalRequest,a=t.canvas.getContext("2d");a.putImageData(i.imageData,r,s)}},r.prototype._repositionCanvas=function(e){var t,i=e.region,r=e.position,s=e.donePartParams,a=e.copyData,n=e.pixelsWidth,l=e.pixelsHeight,h=i.canvas.getContext("2d");void 0!==a&&(a.fromWidth===a.toWidth&&a.fromHeight===a.toHeight?t=h.getImageData(a.fromX,a.fromY,a.fromWidth,a.fromHeight):(this._tmpCanvas||(this._tmpCanvas=document.createElement("canvas"),this._tmpCanvasContext=this._tmpCanvas.getContext("2d")),this._tmpCanvas.width=a.toWidth,this._tmpCanvas.height=a.toHeight,this._tmpCanvasContext.drawImage(i.canvas,a.fromX,a.fromY,a.fromWidth,a.fromHeight,0,0,a.toWidth,a.toHeight),t=this._tmpCanvasContext.getImageData(0,0,a.toWidth,a.toHeight))),i.canvas.width=n,i.canvas.height=l,i!==this._regions[o]&&this._copyOverviewToCanvas(h,r,n,l),void 0!==a&&h.putImageData(t,a.toX,a.toY),i.position=r,i.donePartParams=s},r.prototype._copyOverviewToCanvas=function(e,t,i,r){var s=this._regions[o].position,a=this._regions[o].imagePartParams,n=a.maxXExclusive-a.minX,l=a.maxYExclusive-a.minY,h=s.east-s.west,c=s.north-s.south,u=n/h,_=l/c,d=t.east-t.west,m=t.north-t.south,g=d*u,p=m*_,v=t.west-s.west,f=s.north-t.north,y=v*u,T=f*_;e.drawImage(this._regions[o].canvas,y,T,g,p,0,0,i,r)},r.prototype._opened=function(){this._isReady=!0,this._levelCalculator=this._image.getLevelCalculator();var e={west:this._cartographicBounds.west,east:this._cartographicBounds.east,south:this._cartographicBounds.south,north:this._cartographicBounds.north};s.fixBounds(e,this._decoder,this._adaptProportions),this._cartographicBoundsFixed=e;var t=this._decoder.getImageWidth(),i=this._decoder.getImageHeight();this._quality=this._decoder.getHighestQuality();var r=e.east-e.west,a=e.north-e.south;this._scaleX=t/r,this._scaleY=-i/a,this._translateX=-e.west*this._scaleX,this._translateY=-e.north*this._scaleY;var n={minX:0,minY:0,maxXExclusive:t,maxYExclusive:i,screenWidth:this._overviewResolutionX,screenHeight:this._overviewResolutionY},l=s.alignParamsToTilesAndLevel(n,this._decoder,this._levelCalculator);l.imagePartParams.requestPriorityData=l.imagePartParams.requestPriorityData||{},l.imagePartParams.requestPriorityData.overrideHighestPriority=!0,l.imagePartParams.quality=this._decoder.getLowestQuality();var h=!this._allowMultipleChannelsInSession;this._fetch(o,l,h),this._allowMultipleChannelsInSession&&this._startShowingDynamicRegion()}},{"imagedecoder.js":5,"imagehelperfunctions.js":12,"workerproxyimagedecoder.js":18}],20:[function(e,t,i){"use strict";t.exports.ViewerImageDecoder=e("viewerimagedecoder.js"),t.exports.ImageDecoder=e("imagedecoder.js"),t.exports.FetchManager=e("fetchmanager.js"),t.exports.CesiumImageDecoderLayerManager=e("_cesiumimagedecoderlayermanager.js"),t.exports.ImageDecoderImageryProvider=e("imagedecoderimageryprovider.js"),t.exports.ImageDecoderRegionLayer=e("imagedecoderregionlayer.js")},{"_cesiumimagedecoderlayermanager.js":2,"fetchmanager.js":9,"imagedecoder.js":5,"imagedecoderimageryprovider.js":4,"imagedecoderregionlayer.js":21,"viewerimagedecoder.js":19}],21:[function(e,t,i){"use strict";function r(){return{initialize:function(e){this._options=e||{},void 0!==this._options.latLngBounds&&(this._options=JSON.parse(JSON.stringify(e)),this._options.cartographicBounds={west:e.latLngBounds.getWest(),east:e.latLngBounds.getEast(),south:e.latLngBounds.getSouth(),north:e.latLngBounds.getNorth()}),this._targetCanvas=null,this._canvasPosition=null,this._canvasUpdatedCallbackBound=this._canvasUpdatedCallback.bind(this),this._image=null,this._exceptionCallback=null},setExceptionCallback:function(e){this._exceptionCallback=e,null!==this._image&&this._image.setExceptionCallback(e)},_createImage:function(){null===this._image&&(this._image=new s(this._options.imageImplementationClassName,this._canvasUpdatedCallbackBound,this._options),null!==this._exceptionCallback&&this._image.setExceptionCallback(this._exceptionCallback),this._image.open(this._options.url)["catch"](this._exceptionCallback))},onAdd:function(e){if(void 0!==this._map)throw"Cannot add this layer to two maps";this._map=e,this._createImage(),this._targetCanvas=L.DomUtil.create("canvas","image-decoder-layer-canvas leaflet-zoom-animated"),this._image.setTargetCanvas(this._targetCanvas),this._canvasPosition=null,e.getPanes().mapPane.appendChild(this._targetCanvas),e.on("viewreset",this._moved,this),e.on("move",this._moved,this),L.Browser.any3d&&e.on("zoomanim",this._animateZoom,this),this._moved()},onRemove:function(e){if(e!==this._map)throw"Removed from wrong map";e.off("viewreset",this._moved,this),e.off("move",this._moved,this),e.off("zoomanim",this._animateZoom,this),e.getPanes().mapPane.removeChild(this._targetCanvas),this._targetCanvas=null,this._canvasPosition=null,this._map=void 0,this._image.close(),this._image=null},_moved:function(){this._moveCanvases();var e=a(this._map);this._image.updateViewArea(e)},_canvasUpdatedCallback:function(e){null!==e&&(this._canvasPosition=e,this._moveCanvases())},_moveCanvases:function(){if(null!==this._canvasPosition){var e=this._canvasPosition.west,t=this._canvasPosition.east,i=this._canvasPosition.south,r=this._canvasPosition.north,s=this._map.latLngToLayerPoint([r,e]),a=this._map.latLngToLayerPoint([i,t]),n=a.subtract(s);L.DomUtil.setPosition(this._targetCanvas,s),this._targetCanvas.style.width=n.x+"px",this._targetCanvas.style.height=n.y+"px"}},_animateZoom:function(e){if(null!==this._canvasPosition){var t=this._canvasPosition.west,i=this._canvasPosition.east,r=this._canvasPosition.south,s=this._canvasPosition.north,a=this._map._latLngToNewLayerPoint([s,t],e.zoom,e.center),n=this._map._latLngToNewLayerPoint([r,i],e.zoom,e.center),o=this._map.getZoomScale(e.zoom),l=n.subtract(a),h=l.multiplyBy(.5*(1-1/o)),c=a.add(h);this._targetCanvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(c)+" scale("+o+") "}}}}var s=e("viewerimagedecoder.js"),a=e("leafletfrustumcalculator.js");self.L?t.exports=L.Class.extend(r()):t.exports=function(){throw new Error("Cannot instantiate ImageDecoderRegionLayer: No Leaflet namespace in scope")}},{"leafletfrustumcalculator.js":22,"viewerimagedecoder.js":19}],22:[function(e,t,i){"use strict";var r=e("imagehelperfunctions.js");t.exports=function(e){var t=e.getSize(),i=e.getBounds(),s={west:i.getWest(),east:i.getEast(),south:i.getSouth(),north:i.getNorth()},a=r.calculateFrustum2DFromBounds(s,t);return a}},{"imagehelperfunctions.js":12}]},{},[20])(20)});